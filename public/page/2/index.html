<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>rhel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="rhel">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="rhel">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="rhel">
  
    <link rel="alternate" href="/atom.xml" title="rhel" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">rhel</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">growing study</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-rh134-e7-ac-ac-e5-85-ad-e7-ab-a0-e4-bd-bf-e7-94-a8-e8-ae-bf-e9-97-ae-e6-8e-a7-e5-88-b6-e5-88-97-e8-a1-a8-ef-bc-88acl-ef-bc-89-e6-8e-a7-e5-88-b6-e5-af-b9-e6-96-87-e4-bb-b6-e7-9a-84-e8-ae-bf-e9-97-ae" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/17/rh134-e7-ac-ac-e5-85-ad-e7-ab-a0-e4-bd-bf-e7-94-a8-e8-ae-bf-e9-97-ae-e6-8e-a7-e5-88-b6-e5-88-97-e8-a1-a8-ef-bc-88acl-ef-bc-89-e6-8e-a7-e5-88-b6-e5-af-b9-e6-96-87-e4-bb-b6-e7-9a-84-e8-ae-bf-e9-97-ae/" class="article-date">
  <time datetime="2018-05-17T09:16:40.000Z" itemprop="datePublished">2018-05-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/RHEL134/">RHEL134</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/17/rh134-e7-ac-ac-e5-85-ad-e7-ab-a0-e4-bd-bf-e7-94-a8-e8-ae-bf-e9-97-ae-e6-8e-a7-e5-88-b6-e5-88-97-e8-a1-a8-ef-bc-88acl-ef-bc-89-e6-8e-a7-e5-88-b6-e5-af-b9-e6-96-87-e4-bb-b6-e7-9a-84-e8-ae-bf-e9-97-ae/">RH134 第六章 使用访问控制列表（ACL）控制对文件的访问</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h6 id="访问控制列表概念"><a href="#访问控制列表概念" class="headerlink" title="访问控制列表概念"></a>访问控制列表概念</h6><p>标准Linux 文件权限可以满足绝大多数情况的要求，但它也有局限性。限制访问文件的权限也仅限授予文件所有者、单组成员或其他任何人。进程（正在运行的程序）可能不适合成为文件所属的成员，授予所有人权限则更不是理想的操作。</p>
<p>ACL 允许向文件分配细化权限。除标准的文件所有者、组所有者和其他文件权限之外，还可以向指定用户或指定组，以及由UID或GUID确定的用户和组授予权限。这个权限均应用相同的权限标志：r w x .</p>
<p>文件所有者可以在单个文件或目录上设置ACL 。新文件和子目录可以自动从父目录默认ACL（若存在）中继承ACL设置。与常规文件的访问规则相似，父目录层次结构需要至少设置其他执行权限，以便启用指定用户和指定组的访问权限。</p>
<h6 id="文件系统挂载选项"><a href="#文件系统挂载选项" class="headerlink" title="文件系统挂载选项"></a>文件系统挂载选项</h6><p>文件系统挂载已经启用的ACL 支持。XFS 文件系统内置有 ACL支持。在 RHEL 7上创建的ext4 文件系统默认启用了 acl 选项，而安装红帽早期版本中创建的ext4 文件系统则可能需要通过挂载请求包含ACL 选项，或者在超级块中设置选项。</p>
<h6 id="查看和解释ACL-权限"><a href="#查看和解释ACL-权限" class="headerlink" title="查看和解释ACL 权限"></a>查看和解释ACL 权限</h6><p>ls -l 仅输入最少的 ACL 设置详细信息</p>
<p><img src="/2018/05/17/rh134-e7-ac-ac-e5-85-ad-e7-ab-a0-e4-bd-bf-e7-94-a8-e8-ae-bf-e9-97-ae-e6-8e-a7-e5-88-b6-e5-88-97-e8-a1-a8-ef-bc-88acl-ef-bc-89-e6-8e-a7-e5-88-b6-e5-af-b9-e6-96-87-e4-bb-b6-e7-9a-84-e8-ae-bf-e9-97-ae/1526285537683356.png" alt="image.png"></p>
<p>如果由10个字符组成的权限字符串的末尾是 “+”，即表示此文件有相关联的ACL 设置 。对用户、组和其它的“rwx”标志解释如下：  </p>
<ul>
<li><p>用户：显示用户 ACL 设置，其与标准的用户文件设置相同：rwx</p>
</li>
<li><p>组：显示当前的 ACL 掩码设置，而不是组所有者设置：rw</p>
</li>
<li><p>其他：显示其他 ACL 设置，其与标准的其它文件设置相同，无访问权限。</p>
</li>
</ul>
<h6 id="TIPS"><a href="#TIPS" class="headerlink" title="TIPS:"></a>TIPS:</h6><p>如果使用chmod 更改具有 ACL 文件的组权限，则不会更改组所有者仅限，而是更改 ACL 掩码。如果目的是更新文件的组所有者权限，需要使用<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> setfacl -m g::perms file</span><br></pre></td></tr></table></figure></p>
<h6 id="查看文件-acl"><a href="#查看文件-acl" class="headerlink" title="查看文件 acl"></a>查看文件 acl</h6><p>要显示文件上的 ACL 设置 ，使用 getfacl file</p>
<p><img src="/2018/05/17/rh134-e7-ac-ac-e5-85-ad-e7-ab-a0-e4-bd-bf-e7-94-a8-e8-ae-bf-e9-97-ae-e6-8e-a7-e5-88-b6-e5-88-97-e8-a1-a8-ef-bc-88acl-ef-bc-89-e6-8e-a7-e5-88-b6-e5-af-b9-e6-96-87-e4-bb-b6-e7-9a-84-e8-ae-bf-e9-97-ae/1526286552326310.png" alt="image.png"></p>
<p><img src="/2018/05/17/rh134-e7-ac-ac-e5-85-ad-e7-ab-a0-e4-bd-bf-e7-94-a8-e8-ae-bf-e9-97-ae-e6-8e-a7-e5-88-b6-e5-88-97-e8-a1-a8-ef-bc-88acl-ef-bc-89-e6-8e-a7-e5-88-b6-e5-af-b9-e6-96-87-e4-bb-b6-e7-9a-84-e8-ae-bf-e9-97-ae/1526286628954630.png" alt="image.png"></p>
<p>#前三行是注释，用于识别文件名、所有者（student）、和组所有者（controller）.如果存在任何其它文件标志（如 setuid 或 setgid ),则会出现第四行注释来显示所设置的标志。</p>
<p><img src="/2018/05/17/rh134-e7-ac-ac-e5-85-ad-e7-ab-a0-e4-bd-bf-e7-94-a8-e8-ae-bf-e9-97-ae-e6-8e-a7-e5-88-b6-e5-88-97-e8-a1-a8-ef-bc-88acl-ef-bc-89-e6-8e-a7-e5-88-b6-e5-af-b9-e6-96-87-e4-bb-b6-e7-9a-84-e8-ae-bf-e9-97-ae/1526286600143773.png" alt="image.png"></p>
<ol>
<li><p>文件所有者权限。student 具有 rwx 。  </p>
</li>
<li><p>指定用户权限。与此文件相关联的每位指定用户均有一个条目。james 不具有任何权限。</p>
</li>
<li><p>指定用户权限。UID 1005 具有 rwx ，但是掩码将有效权限限制为rw </p>
</li>
</ol>
<h6 id="掩码条目："><a href="#掩码条目：" class="headerlink" title="掩码条目："></a>掩码条目：</h6><p><img src="/2018/05/17/rh134-e7-ac-ac-e5-85-ad-e7-ab-a0-e4-bd-bf-e7-94-a8-e8-ae-bf-e9-97-ae-e6-8e-a7-e5-88-b6-e5-88-97-e8-a1-a8-ef-bc-88acl-ef-bc-89-e6-8e-a7-e5-88-b6-e5-af-b9-e6-96-87-e4-bb-b6-e7-9a-84-e8-ae-bf-e9-97-ae/1526288457208748.png" alt="image.png"></p>
<p>掩码设置显示可能为所有指定用户、组所有者和指定组提供的最大权限 。 UID 1005 、controller 和 GID 2210 无法执行此文件，即便每个条目增均已经设置执行权限。</p>
<h6 id="其它条目："><a href="#其它条目：" class="headerlink" title="其它条目："></a>其它条目：</h6><p><img src="/2018/05/17/rh134-e7-ac-ac-e5-85-ad-e7-ab-a0-e4-bd-bf-e7-94-a8-e8-ae-bf-e9-97-ae-e6-8e-a7-e5-88-b6-e5-88-97-e8-a1-a8-ef-bc-88acl-ef-bc-89-e6-8e-a7-e5-88-b6-e5-af-b9-e6-96-87-e4-bb-b6-e7-9a-84-e8-ae-bf-e9-97-ae/1526288467671948.png" alt="image.png"></p>
<p>其他或“全局”权限。所有其他的UID 和GID 均无任何权限。</p>
<h6 id="查看目录-ACL"><a href="#查看目录-ACL" class="headerlink" title="查看目录 ACL"></a>查看目录 ACL</h6><p>要显示目录上的 ACL 设置，使用 getfacl /direcotry:</p>
<p><img src="/2018/05/17/rh134-e7-ac-ac-e5-85-ad-e7-ab-a0-e4-bd-bf-e7-94-a8-e8-ae-bf-e9-97-ae-e6-8e-a7-e5-88-b6-e5-88-97-e8-a1-a8-ef-bc-88acl-ef-bc-89-e6-8e-a7-e5-88-b6-e5-af-b9-e6-96-87-e4-bb-b6-e7-9a-84-e8-ae-bf-e9-97-ae/1526288669879354.png" alt="image.png"></p>
<h6 id="打开注释条目："><a href="#打开注释条目：" class="headerlink" title="打开注释条目："></a>打开注释条目：</h6><p><img src="/2018/05/17/rh134-e7-ac-ac-e5-85-ad-e7-ab-a0-e4-bd-bf-e7-94-a8-e8-ae-bf-e9-97-ae-e6-8e-a7-e5-88-b6-e5-88-97-e8-a1-a8-ef-bc-88acl-ef-bc-89-e6-8e-a7-e5-88-b6-e5-af-b9-e6-96-87-e4-bb-b6-e7-9a-84-e8-ae-bf-e9-97-ae/1526288787444516.png" alt="image.png"></p>
<p>前三行是注释，用于识别目录名、所有者（student)和组所有者（controller）。如果存在任何其他目录标志（如 setuid,setgid,sticky）,则会出现第四行注释来显示所设置的标志（示例为 setgid）</p>
<h6 id="标准-ACL-条目"><a href="#标准-ACL-条目" class="headerlink" title="标准 ACL 条目"></a>标准 ACL 条目</h6><p><img src="/2018/05/17/rh134-e7-ac-ac-e5-85-ad-e7-ab-a0-e4-bd-bf-e7-94-a8-e8-ae-bf-e9-97-ae-e6-8e-a7-e5-88-b6-e5-88-97-e8-a1-a8-ef-bc-88acl-ef-bc-89-e6-8e-a7-e5-88-b6-e5-af-b9-e6-96-87-e4-bb-b6-e7-9a-84-e8-ae-bf-e9-97-ae/1526347461483244.png" alt="image.png"></p>
<p>此目录上的 ACL 权限与前述文件示例中的相同，但适用于目录。其关键区别在于这些条目包含了执行权限（适用时），以允许目录搜索权限  </p>
<h6 id="默认条目"><a href="#默认条目" class="headerlink" title="默认条目"></a>默认条目</h6><p><img src="/2018/05/17/rh134-e7-ac-ac-e5-85-ad-e7-ab-a0-e4-bd-bf-e7-94-a8-e8-ae-bf-e9-97-ae-e6-8e-a7-e5-88-b6-e5-88-97-e8-a1-a8-ef-bc-88acl-ef-bc-89-e6-8e-a7-e5-88-b6-e5-af-b9-e6-96-87-e4-bb-b6-e7-9a-84-e8-ae-bf-e9-97-ae/1526347563548361.png" alt="image.png"></p>
<ol>
<li><p>默认文件所有者 ACL 权限。 文件所有者将获得 rwx ，并在新子目录上执行操作  </p>
</li>
<li><p>默认指定用户 ACL 权限，每位指定用户均有一个条目，他们将自动获得应用到新文件或子目录的默认ACL ，james 始终默认设置为没有任何权限</p>
</li>
</ol>
<p><img src="/2018/05/17/rh134-e7-ac-ac-e5-85-ad-e7-ab-a0-e4-bd-bf-e7-94-a8-e8-ae-bf-e9-97-ae-e6-8e-a7-e5-88-b6-e5-88-97-e8-a1-a8-ef-bc-88acl-ef-bc-89-e6-8e-a7-e5-88-b6-e5-af-b9-e6-96-87-e4-bb-b6-e7-9a-84-e8-ae-bf-e9-97-ae/1526347790707759.png" alt="image.png"></p>
<p>默认掩码设置显示可能为所有新建文件或目录，（其具有指定用户 ACL 、组所有者 ACL 或指定组 ACL ）提供的初始最大权限： 读取和写入新文件，对新子目录的执行权限，但是新文件永远不可获得执行权限。  </p>
<p><img src="/2018/05/17/rh134-e7-ac-ac-e5-85-ad-e7-ab-a0-e4-bd-bf-e7-94-a8-e8-ae-bf-e9-97-ae-e6-8e-a7-e5-88-b6-e5-88-97-e8-a1-a8-ef-bc-88acl-ef-bc-89-e6-8e-a7-e5-88-b6-e5-af-b9-e6-96-87-e4-bb-b6-e7-9a-84-e8-ae-bf-e9-97-ae/1526347988908292.png" alt="image.png"></p>
<p>默认其它或“全局”权限，所有其它 UID 和 GID  对新文件或新子目录均没有任何权限。  </p>
<p>上述示例中的默认条目不包括指定用户 （ UID 1005）和指定组（GID 2210），因此，它们不会自动获得添加至任何新文件或新子目录的初始 ACL 条目。这会有效的将他们限制在其已具有 ACL 的文件和子目录中，或者限制在相关文件所有者后来使用 setfacl 添加了 ACL 的文件和子目录。这些条目仍可创建自己的文件和子目录。</p>
<h6 id="TIPS-1"><a href="#TIPS-1" class="headerlink" title="TIPS:"></a>TIPS:</h6><p>getfacl 中的输出可用作 setfacl 的输入。使用 getfacl -R /directory 生成目录及其内容的输出，通过将此输出传递给 setfacl –set-file=file 进行批量更新，可保存此输出并可用于日后恢复。</p>
<p>ACL 掩码  </p>
<p>ACL  掩码定义可授予指定用户、组所有者和指定组的最大权限。它不限制文件所有者或其他用户的权限。所有实施 ACL 的文件和目录都将具有ACL 掩码。</p>
<p>可使用 getfacl 查看掩码，并通过 setfacl 显示设置掩码。如果未显式设置，系统会自动计算并添加掩码；但也可从父目录默认掩码设置中继承掩码。默认情况下，每当添加、修改或删除任何受影响的 ACL 时，均会重新计算掩码。 </p>
<h6 id="ACL-权限优先级"><a href="#ACL-权限优先级" class="headerlink" title="ACL 权限优先级"></a>ACL 权限优先级</h6><p>在决定一个进程（正在运行的程序）能否访问文件时，将按如下所示应用文件权限和 ACL ：</p>
<ul>
<li><p>如果正在以文件所有者身份运行进程，则应用文件的用户 ACL 权限。</p>
</li>
<li><p>如果正在以指定用户 ACL 条目中列出的用户身份运行进程，则应用指定用户 ACL 权限（只要掩码允许）</p>
</li>
<li><p>如果正在以与文件的组所有者相匹配的组身份运行进程，或者以具有显式指定组 ACL 条目的组身份运行进程，则应用相匹配的 ACL 权限（只要掩码允许 ）</p>
</li>
<li><p>否则，将应用文件的其它 ACL 权限。</p>
</li>
</ul>
<h5 id="使用-ACL-保护文件安全"><a href="#使用-ACL-保护文件安全" class="headerlink" title="使用 ACL 保护文件安全"></a>使用 ACL 保护文件安全</h5><h6 id="更改-ACL-文件权限"><a href="#更改-ACL-文件权限" class="headerlink" title="更改 ACL 文件权限"></a>更改 ACL 文件权限</h6><p>使用 setfacl 添加、修改或删除文件和目录的标准 ACL </p>
<p>ACL 采用普通的权限文件系统表示法：rwx (读、写、执行)，“-”表示缺少相关权限。X(大写) 表示如果文件还没有相关的执行权限，则只设置目录的执行权限，用户同 chmod </p>
<h6 id="添加或修改-ACL-权限"><a href="#添加或修改-ACL-权限" class="headerlink" title="添加或修改 ACL 权限"></a>添加或修改 ACL 权限</h6><p>可以使用 -m 通过合作行设置，或者使用 -M（使用“-”（短划线），而不使用 stdin 的文件名）通过文件传递 ACL 。这两个选项会为文件或目录添加新的 ACL 条目，或替换特定的现在 ACL 条目。文件或目录的任何其它现在 ACL 条目不变</p>
<p>使用 –set 或 –set-file 选项来完全替换文件的 ACL 设置</p>
<p>首次定义文件的 ACL 时，如果添加操作不包含文件所有者、组所有者或其它权限的设置，则系统会基于当前标准文件权限来设置以上权限的设置（这些设置也称为基础 ACL ，且无法删除），系统也会计算并添加新掩码值。</p>
<p>要添加或修改用户 ACL 或指定用户 ACL ：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setfacl -m u:name:rX file</span><br></pre></td></tr></table></figure></p>
<p>如果 name 留空，则它适用于文件所有者，否则 name 可以是用户名或 UID 值。在本例中，授予权限为只读和执行（需要文件所属组有执行权限）（除非 file 为目录，此时目录设置执行权限，以允许进程目录搜索）</p>
<p>ACL 文件所有者和标准文件所有者权限相同，因此使用chmod 设置所有者权限对 ACL 没有任何影响</p>
<p>要添加或修改组 ACL 或指定组 ACL<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setfacl -m g:name:rw file</span><br></pre></td></tr></table></figure></p>
<p>与添加或修改用户 ACL 的模式相同，如果 name 留空，则它适用于所有者。否则请指定组名或 GID 值。</p>
<p>对于具有 ACL 设置的谁的， chmod 的对任何组权限都没有影响，但会更新 ACL 掩码。  </p>
<p>要添加或修改其它 ACL<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setfacl -m o::- file</span><br></pre></td></tr></table></figure></p>
<p>其它 ACL 仅接受权限设置，权限通常为 “-”即无权限，或者指定任何标准权限 rwx </p>
<p>ACL 其它权限及标准其他权限相同，因此使用其它权限中的 chmod 等于使用其它权限中的 setfacl </p>
<p>通过一条命令添加多个条目，并以逗号分隔各个条目<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setfacl -m u::rwx,g:sodor:rX,o::- file</span><br></pre></td></tr></table></figure></p>
<h6 id="使用-getfacl-作为输入"><a href="#使用-getfacl-作为输入" class="headerlink" title="使用 getfacl 作为输入"></a>使用 getfacl 作为输入</h6><p>getfacl 的输出作为 setfacl 输入<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">getfacl file-A | setfacl --<span class="built_in">set</span>-file=- file-B</span><br><span class="line"><span class="comment"># --set-file 接受文件或 stdin 中的输入，‘-’指定了 stdin 的使用。在此例中，file-B 和 file-A 设置相同。</span></span><br></pre></td></tr></table></figure></p>
<h6 id="设置明确的-ACL-掩码"><a href="#设置明确的-ACL-掩码" class="headerlink" title="设置明确的 ACL 掩码"></a>设置明确的 ACL 掩码</h6><p>可以明确设置文件或目录的 ACL 掩码，以限制指定用户、组所有者和指定组的最大有效权限。限制超出掩码的权限。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setfacl -m m::r file</span><br></pre></td></tr></table></figure></p>
<p>该操作会设置 ACL 的掩码值为只读权限，此设置不影响所有者和其它用户。</p>
<p>getfacl 时会在受掩码设置限制的条目旁边显示 “注释”</p>
<h6 id="TIPS-2"><a href="#TIPS-2" class="headerlink" title="TIPS:"></a>TIPS:</h6><p>默认情况下，每当修改或删除受影响的 ACL 设置（指定用户、组所有者或指定组）时系统都会重新计算 ACL 掩码，进而可能重新设置上一个明确的掩码设置。</p>
<p>为避免重新计算掩码，请使用 -n ,或者将掩码设置 （ -m m::perms） 包含在会修改受掩码影响的 ACL 设置的任何 setfacl 操作中。</p>
<p>递归 ACL 修改，使用 -R 选项<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setfacl -R -m u:name:rX directory</span><br><span class="line"></span><br><span class="line"><span class="comment">#该操作会将用户name 添加到 directory 和所有文件和子目录中，从而授予只读和条件执行权限。</span></span><br></pre></td></tr></table></figure></p>
<h6 id="删除-ACL"><a href="#删除-ACL" class="headerlink" title="删除 ACL"></a>删除 ACL</h6><p>无需指定 “:perms（权限）” 外，删除特定 ACL 条目与修改操作的基本形式相同。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setfacl -x u:name,g:name file</span><br></pre></td></tr></table></figure></p>
<p>该操作只会从文件或目录 ACL 列表中删除指定用户和指定组。任何其它现有 ACL 均保持活动。可以在同一 setfacl 操作中使用删除 (-x) 和 修改 （-m）操作。</p>
<p>掩码只能在未设置其它 ACL （无法删除的基础 ACL 除外）的情况下删除。因此必须最后删除。文件不再有 ACL ，并且 ls -l 不会在权限字符串旁边显示 “+” 符号。要删除文件或目录的所有 ACL （包括目录的默认 ACL ）使用：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setfacl -b file</span><br></pre></td></tr></table></figure></p>
<h6 id="控制默认-ACL-文件权限"><a href="#控制默认-ACL-文件权限" class="headerlink" title="控制默认 ACL 文件权限"></a>控制默认 ACL 文件权限</h6><p>目录可以设置默认 ACL ，这些 ACL 会由所有新文件和新子目录自动继承，可以针对各个标准 ACL 设置来设置默认 ACL 权限，其中包括默认掩码</p>
<p>目录仍然需要具备标准 ACL 才能进程访问权限控制，因为默认 ACL 不会对目录实施访问权限控制；他们仅提供 ACL 权限继承支持。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setfacl -m d:u:name:rx directory</span><br></pre></td></tr></table></figure></p>
<p>该命令会添加一个默认的指定用户（d:u:name），该用户拥有对子目录的只读和执行权限。</p>
<p>用于为各个 ACL 类型添加默认 ACL 的 setfacl 命令与用于标准 ACL 的命令完全相同，但是以 “d:” 开关，或者在命令行使用 “-d” 选项。</p>
<h6 id="TIPS："><a href="#TIPS：" class="headerlink" title="TIPS："></a>TIPS：</h6><p>设置目录默认 ACL 时，需要在默认 ACL 中包含执行权限（X）来确保用户可以访问子目录.</p>
<p>用户不会自动设置对新文件的常规文件执行权限，新常规文件的掩码为rw-</p>
<p>新文件和新子目录会继续从创建用户设置自己的 UID 和主要组 GID 值，不过当父目录 setgid 标志启用时除外，这种情况下，主要组 GID 与 父目录 GID 相同。</p>
<h6 id="删除默认-ACL"><a href="#删除默认-ACL" class="headerlink" title="删除默认 ACL"></a>删除默认 ACL</h6><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">setfacl -x d:u:name directory </span><br><span class="line">setfacl -k /directory     <span class="comment">#删除目录的所有默认 ACL </span></span><br><span class="line">setfacl -b /directory     <span class="comment">#删除目录的所有 ACL</span></span><br><span class="line"></span><br><span class="line">setfacl -Rm g:sodor:rwX /shares/steamies    <span class="comment">#递归授予sodor组 读取、写入、条件执行权限。（仅针对目录和现有可执行文件）</span></span><br><span class="line">setfacl -Rm u:james:- /shares/steamies    <span class="comment">#递归授予 james 无任何权限</span></span><br><span class="line">setfacl -m d:g:sodor:rwx /shares/steamies    <span class="comment">#添加sodor 组默认访问规则，steamies 目录的读取、写入、执行权限</span></span><br><span class="line">setfacl -m d:u:james:- /share/steamies    <span class="comment">#添加用户james 对steamies 目录无任何权限</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/17/rh134-e7-ac-ac-e5-85-ad-e7-ab-a0-e4-bd-bf-e7-94-a8-e8-ae-bf-e9-97-ae-e6-8e-a7-e5-88-b6-e5-88-97-e8-a1-a8-ef-bc-88acl-ef-bc-89-e6-8e-a7-e5-88-b6-e5-af-b9-e6-96-87-e4-bb-b6-e7-9a-84-e8-ae-bf-e9-97-ae/" data-id="cjqlgp08m001tqtkj1mcv5h50" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-rh134-e7-ac-ac-e4-ba-94-e7-ab-a0-e7-ae-a1-e7-90-86linux-e8-bf-9b-e7-a8-8b-e4-bc-98-e5-85-88-e7-ba-a7" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/14/rh134-e7-ac-ac-e4-ba-94-e7-ab-a0-e7-ae-a1-e7-90-86linux-e8-bf-9b-e7-a8-8b-e4-bc-98-e5-85-88-e7-ba-a7/" class="article-date">
  <time datetime="2018-05-14T03:30:58.000Z" itemprop="datePublished">2018-05-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/RHEL134/">RHEL134</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/14/rh134-e7-ac-ac-e4-ba-94-e7-ab-a0-e7-ae-a1-e7-90-86linux-e8-bf-9b-e7-a8-8b-e4-bc-98-e5-85-88-e7-ba-a7/">RH134 第五章 管理Linux 进程优先级</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h6 id="Linux-进程调度和多任务"><a href="#Linux-进程调度和多任务" class="headerlink" title="Linux 进程调度和多任务"></a>Linux 进程调度和多任务</h6><p>   通过使用称为时间片的技术，Linux（和其它操作系统）实际能够运行的进程数（和线程数）可以超出可用的实际处理单元数。操作系统进程调度程序将在单个核心上的进程之间快速切换，从而给用户一种有多个进程在同时运行的印象。  </p>
<p>相对优先级</p>
<p>   由于不是每种进程都与其它进程同样重要，可告知高度程序为不同的进程使用不同的调度策略。常规系统上运行的大多数进程所使用的调度策略称为SCHED_OTHER(也称为SCHED_NORMAL),但还有一些其他策略可用于不同的目的。  </p>
<p>   由于并非所有进程都以同样的方式创建，可为采用SCHED_NORMAL 策略运行的进程指定相对优先级。此优先级称为进程的 nice 值，一个进程可以有正好 40 种不同的 nice 值。这些 nice 值正好从 -20 到 19。默认情况下，进程将继承其父进程的 nice 级别，通常为 0 ， nice 值 级别越高，表示优先级越低（该进程容易将其 CPU 使用量让给其他进程）； nice 级别越低，表示优先级越高（该进程更加不倾向于让出CPU）。  </p>
<p><img src="/2018/05/14/rh134-e7-ac-ac-e4-ba-94-e7-ab-a0-e7-ae-a1-e7-90-86linux-e8-bf-9b-e7-a8-8b-e4-bc-98-e5-85-88-e7-ba-a7/1526262567734231.png" alt="image.png"></p>
<h6 id="nice-级别和权限"><a href="#nice-级别和权限" class="headerlink" title="nice 级别和权限"></a>nice 级别和权限</h6><p>   为很占CPU资源的进程设置较低的 nice 级别可能对同一系统上运行的其它进程的性能造成负面影响，所以仅允许 root 用户（更具体的说，具有 CAP_SYS_NICE 功能的用户）设置负 nice 级别以及降低现有进程的 nice 级别。  </p>
<p>   普通非特权用户仅允许设置正的nice 级别。此外，他们只能对现有进程提升 nice 级别。而不能降低 nice 级别  </p>
<h6 id="TIP："><a href="#TIP：" class="headerlink" title="TIP："></a>TIP：</h6><p>   除 nice 级别以外，还有更多方法可以影响进程优先级和资源使用情况。有备用的高度程序策略和设置、控制组（cgroups）等等，但是 ,nice 级别是最容易的，并且系统管理员和普通用户都可以使用。  </p>
<p>使用 nice 和 renice  影响进程优先级</p>
<h6 id="查看-nice-级别"><a href="#查看-nice-级别" class="headerlink" title="查看 nice 级别"></a>查看 nice 级别</h6><p>   可以通过多种不同的方式查看现有进程的 nice 级别。大多数进程管理工具（如 gnome-system-monitor）默认情况下已显示 nice 级别，或可以配置为显示 nice 级别。  </p>
<h6 id="使用top-显示-nice-级别"><a href="#使用top-显示-nice-级别" class="headerlink" title="使用top 显示 nice 级别"></a>使用top 显示 nice 级别</h6><p>   top 命令可用于通过交互方式查看（和管理）进程。在默认配置中，top 将显示与 nice 级别有关的两列：N1 表示实际 nice 级别，而PR将 nice 级别显示为映射到更大优先级队列： nice 级别 -20 映射到优先级 0 ，而 nice 级别 +19 映射到优先级39。  </p>
<h6 id="使用ps-显示-nice-级别"><a href="#使用ps-显示-nice-级别" class="headerlink" title="使用ps 显示 nice 级别"></a>使用ps 显示 nice 级别</h6><p>   ps 命令也可以显示进程的 nice 级别，但它在大多数默认输出格式中并不显示，然后，用户可以通过 ps 准备请求所需的列，而 nice 字段的名称为 nice   </p>
<p>#ps 请求包括 pid 、名称和nice 级别，按 nice 级别降序排列：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@server0 ~]<span class="comment"># ps axo pid,comm,nice --sort=-nice</span></span><br><span class="line">   PID COMMAND          NI</span><br><span class="line">   286 khugepaged       19</span><br><span class="line">   884 alsactl          19</span><br><span class="line">  2639 tracker-miner<span class="_">-f</span>  19</span><br><span class="line">   285 ksmd              5</span><br><span class="line">   927 rtkit-daemon      1</span><br><span class="line">     1 systemd           0</span><br><span class="line">     2 kthreadd          0</span><br><span class="line">     3 ksoftirqd/0       0</span><br><span class="line">     7 migration/0       -</span><br><span class="line">     8 rcu_bh            0</span><br></pre></td></tr></table></figure></p>
<p>某些进程的nice 级别可能报告为 - 。这些进程使用不同的高度策略运行，并且调度程序几乎将他们视为具有较高优先级。通过从ps 请求 cls 字段，可以显示调度程序策略。此字段中的 TS 表示该进程在 SCHED_NORMAL 下运行并且可以使用 nice 级别；任何其它内容都表示正在使用不同的调度程序策略。  </p>
<h6 id="启动具有不同-nice-级别的进程"><a href="#启动具有不同-nice-级别的进程" class="headerlink" title="启动具有不同 nice 级别的进程"></a>启动具有不同 nice 级别的进程</h6><p>启动进程时，它通常将继承父进程的 nice 级别。这表示从命令行启动一个进程时，它将与从其启动的shell进程具有相同的nice 级别。在大多数情况下，这将导致新进程运行的 nice 级别为 0 。</p>
<p>要启动具有不同 nice 级别的进程，用户和系统管理员可以使用 nice 工具运行其命令。不带任何其它选项的情况下，运行 nice <command> 将启动 nice 级别为 10 的 <command>.通过 nice 命令使用 -n <nicelevel> 选项，可以选择其他 nice 级别。如：启动 nice 级别为 15 的命令 dogecoinminer 并将其立即发送到后台:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nice -n 15 dogecoinminer &amp;</span><br></pre></td></tr></table></figure></nicelevel></p>
<h6 id="TIP"><a href="#TIP" class="headerlink" title="TIP:"></a>TIP:</h6><p>非特权用户允许设置正的 nice级别 （0 - 19 ）。只有 root 可以设置负的 nice级别 （- 20 到 -1）。</p>
<h6 id="更改现有进程的-nice-级别"><a href="#更改现有进程的-nice-级别" class="headerlink" title="更改现有进程的 nice 级别"></a>更改现有进程的 nice 级别</h6><p>可以在命令行中使用 renice 命令来更改现有进程的 nice 级别。 renice 命令的语法如下：</p>
<p>renice -n <nicelevel> <pid> … （可以一次指定多个进程）</pid></nicelevel></p>
<p>renice -n -7 $(pgrep origami@home)    #将所有origami@home进程的 nice 级别更改为 -7 </p>
<h6 id="TIP-1"><a href="#TIP-1" class="headerlink" title="TIP:"></a>TIP:</h6><p>普通用户仅允许提升 nice 级别，只有 root 才能使用 renice 降低 nice 级别。</p>
<p>也可以使用 top 命令（以交互方式）更改进程的 nice 级别，在top 中，按 r ，然后跟要更改的 PID 和 新的 nice 级别  </p>
<p><img src="/2018/05/14/rh134-e7-ac-ac-e4-ba-94-e7-ab-a0-e7-ae-a1-e7-90-86linux-e8-bf-9b-e7-a8-8b-e4-bc-98-e5-85-88-e7-ba-a7/1526266653786433.png" alt="image.png"></p>
<p><img src="/2018/05/14/rh134-e7-ac-ac-e4-ba-94-e7-ab-a0-e7-ae-a1-e7-90-86linux-e8-bf-9b-e7-a8-8b-e4-bc-98-e5-85-88-e7-ba-a7/1526266685205928.png" alt="image.png"></p>
<p><img src="/2018/05/14/rh134-e7-ac-ac-e4-ba-94-e7-ab-a0-e7-ae-a1-e7-90-86linux-e8-bf-9b-e7-a8-8b-e4-bc-98-e5-85-88-e7-ba-a7/1526266750818667.png" alt="image.png"></p>
<p><img src="/2018/05/14/rh134-e7-ac-ac-e4-ba-94-e7-ab-a0-e7-ae-a1-e7-90-86linux-e8-bf-9b-e7-a8-8b-e4-bc-98-e5-85-88-e7-ba-a7/1526266722562134.png" alt="image.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/14/rh134-e7-ac-ac-e4-ba-94-e7-ab-a0-e7-ae-a1-e7-90-86linux-e8-bf-9b-e7-a8-8b-e4-bc-98-e5-85-88-e7-ba-a7/" data-id="cjqlgp06g0013qtkjectn4d9m" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-rh134-e7-ac-ac-e5-9b-9b-e7-ab-a0-e8-ae-a1-e5-88-92-e5-b0-86-e6-9d-a5-e7-9a-84linux-e4-bb-bb-e5-8a-a1" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/14/rh134-e7-ac-ac-e5-9b-9b-e7-ab-a0-e8-ae-a1-e5-88-92-e5-b0-86-e6-9d-a5-e7-9a-84linux-e4-bb-bb-e5-8a-a1/" class="article-date">
  <time datetime="2018-05-14T01:25:12.000Z" itemprop="datePublished">2018-05-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/RHEL134/">RHEL134</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/14/rh134-e7-ac-ac-e5-9b-9b-e7-ab-a0-e8-ae-a1-e5-88-92-e5-b0-86-e6-9d-a5-e7-9a-84linux-e4-bb-bb-e5-8a-a1/">RH134 第四章 计划将来的linux 任务</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>使用at 计划一次性任务</strong></p>
<p>at 不是单机工具，而是一个系统守护进程（atd），它有一组命令行工具可与守护进程（at,atd 等）进行交互。在默认的RHEL安装过程中，atd 守护进程将自动安装和启用。atd 守护进程可以在at软件包中找到。</p>
<p>用户（包括root）可使用命令行工具 at 为 atd 守护进程的作业排除。atd 守护进程提供了 a 到 z 共26个队列。作业按字母顺序排列，队列越后，系统优先级越低</p>
<p><strong>计划作业</strong></p>
<p>使用命令 at <timespec> 可以计划新作业。at 随后会读取从stdin 执行的命令。对于较大的命令以及错别字敏感的命令，使用来自脚本文件(例如at now +5min &lt;myscript) 的输入重定向比在终端窗口中手动输入所有命令要简单。手动输入命令时，可以通过 Ctrl +D 来完成输入。</timespec></p>
<p><timespec> 允许许多强大的组合，使用户（几乎）可以自由地来说明应运行作业的确切时间。通常这些组合以时间（例如02:00pm,13:59 甚至teatime）开头，后面接一个可选日期或将来的天数。</timespec></p>
<ul>
<li><p>now +5min</p>
</li>
<li><p>teatime tomorrow (下等茶时间16:00)</p>
</li>
<li><p>noon +4    days  (noon 12:00)</p>
</li>
<li><p>5pm august 3 2016 </p>
</li>
</ul>
<p><strong>检查管理作业</strong></p>
<p>stq 或者 at -l<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@desktop0 ~]<span class="comment"># at -l    #查看任务计划</span></span><br><span class="line">1Wed May  9 12:00:00 2018 a root</span><br><span class="line"><span class="comment">#共4列</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>作业编号，当前为1</p>
</li>
<li><p>该作业计划的日期和时间，Wed May 9 12:00:00 2018</p>
</li>
<li><p>作业所在队列是a</p>
</li>
<li><p>作业所有者（以及将运行作业的用户身份），当前为root</p>
</li>
</ul>
<p>普通的非特权用户只能查看和控制自己的作业。root 可以查看和管理所有作业  </p>
<p>要检查执行作业时运行的实际命令，请使用命令at -c <jobnumber> ,该输入首先会显示所设置作业环境，以便在用户创建作业时反映用户的环境，后跟运行的实际命令。</jobnumber></p>
<p><strong>删除作业</strong></p>
<p>atrm &lt;JobNumber> 将会删除计划的作业。当不再需要作业时（例如，远程防火墙配置成功且不需要重置时）</p>
<p>atrm 1    #删除任务计划 1</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@desktop0 ~]<span class="comment"># echo "date &gt; ~/myjob" | at now +3min    #设置任务计划</span></span><br><span class="line">job 4 at Tue May  8 15:16:00 2018</span><br><span class="line">[root@desktop0 ~]<span class="comment"># atq        #查看任务计划</span></span><br><span class="line">4Tue May  8 15:16:00 2018 a root</span><br><span class="line"></span><br><span class="line">[root@desktop0 ~]<span class="comment"># at -q g teatime tomorrow    #在任务队列 g 创建作业任务</span></span><br><span class="line">at&gt; touch /home/student/tea            <span class="comment">#任务内容</span></span><br><span class="line">at&gt; &lt;EOT&gt;                        <span class="comment">#Ctrl + D 退出任务编辑</span></span><br><span class="line">job 6 at Wed May  9 16:00:00 2018</span><br><span class="line">[root@desktop0 ~]<span class="comment"># atq        #   查看任务</span></span><br><span class="line">6Wed May  9 16:00:00 2018 g root</span><br><span class="line">[root@desktop0 ~]<span class="comment"># at -q b 16:05 tomorrow    #在任务队列 b 创建作业任务</span></span><br><span class="line">at&gt; touch /home/student/cookies</span><br><span class="line">at&gt; &lt;EOT&gt;</span><br><span class="line">job 7 at Wed May  9 16:05:00 2018</span><br><span class="line">[root@desktop0 ~]<span class="comment"># atq    #查看</span></span><br><span class="line">6	Wed May  9 16:00:00 2018 g root</span><br><span class="line">7	Wed May  9 16:05:00 2018 b root</span><br><span class="line">[root@desktop0 ~]<span class="comment"># at -c 6     #查看作业任务6的详细信息</span></span><br><span class="line">[root@desktop0 ~]<span class="comment"># atrm 6    #删除</span></span><br><span class="line">[root@desktop0 ~]<span class="comment"># atq</span></span><br><span class="line">7	Wed May  9 16:05:00 2018 b root</span><br></pre></td></tr></table></figure>
<p><strong>使用cron计划周期性作业</strong></p>
<p>at 是一次性作业任务，在RHEL 中附带了特别针对周期性作业的crond 守护进程，且默认开机启用并启动。crond 是由多个配置文件和系统范围内的文件控制的，每个用户对应一个配置文件（使用crontab(1) 命令进行编辑）。这些配置文件使用户和管理员拥有细微的控制权，可以控制应执行周期性作业的确切时间。crond 守护进程作为 cronie软件包的一部分安装。  </p>
<p>如果从cron 作业运行的命令向末重定向的 stdout 或 stderr 生成任何输出，则crond 守护进程将尝试使用系统中配置的邮件服务器将该输出通过电子邮件发送给拥有该作业的用户（除非被覆盖）。根据环境，这可能需要其它配置。</p>
<p><strong>计划作业</strong></p>
<p>普通用户使用crontab 命令来管理作业，可以通过四种方式调用该<br>命令：</p>
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th>预期用途</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">crontab -l</td>
<td>列出当前用户的计划任务</td>
</tr>
<tr>
<td style="text-align:left">crontab -r</td>
<td>删除当前用户的所有计划任务</td>
</tr>
<tr>
<td style="text-align:left">crontab -c</td>
<td>编辑当前用户的计划任务</td>
</tr>
<tr>
<td style="text-align:left">crontab <filename></filename></td>
<td>删除所有作业，并替换为从<filename>读取作业。如果未指定任何文件，则将使用stdin </filename></td>
</tr>
</tbody>
</table>
<p>root 可以使用 -u  username 选项管理其他用户的作业。不建议使用crontab 命令来管理系统作业。</p>
<p>在使用crontab -e 编辑作业时，编辑器会启动（如果editor 环境变量尚未设置其它值，则默认为vi），正在编辑的文件，每行均有一个作业。允许有空行，并且注释的行以 （#）开头。环境变量也可以使用格式：NAME=value 来声明，并且会影响声明所在行下面的所有行。crontab 中的常见变量包括 SHELL 和 MAILTO 。设置SHELL 变量将会更改用于其下面的行中执行命令的shell ，而设置 MAILTO 变量将会更改发送到电子邮件地址输出（所有）</p>
<p>重要提示：发送电子邮件可能需要另外配置本地邮件服务器或系统中的SMTP转发</p>
<p>各个作业都包含 6 个字段，详述了执行的时间和内容，如果前 5 个字段都与当前日期和时间相匹配，则会执行最后一个字段中的命令，这些字段包括：</p>
<ul>
<li><p>分钟 </p>
</li>
<li><p>小时 </p>
</li>
<li><p>几号 </p>
</li>
<li><p>月份 </p>
</li>
<li><p>星期几 </p>
</li>
<li><p>命令</p>
</li>
</ul>
<p>如果几号和星期几字段都不是 * ，则该命令将在其中任一字段匹配时执行，例如 * * 15 * 5 ls ,将在每月 15 号或每周 5 执行ls命令</p>
<p>前 5 个字段全部使用相同的语法规则：</p>
<ul>
<li><p>* 表示“无关紧要”/始终</p>
</li>
<li><p>数字可用于指定分钟，小时，日期或工作日。（对于工作日0 - 7，0表示星期日，1表示星期一，依次类推。7也表示星期日）</p>
</li>
<li><p>x-y 表示范围，x到y(含)</p>
</li>
<li><p>x,y 表示列表。列表也可以包含范围，例如“分钟”列中的5,10-13,17,表示作业应当在每小时的第5，10-13，17分钟分别运行一次</p>
</li>
<li><p>*/x 表示x的时间间隔，例如分钟列 */7 表示每 7 分钟运行一次。</p>
</li>
</ul>
<p>此外，可以使用三个字母的英文缩写来表示月份和工作日，例如Jan ,Feb 以及 Tue , Wed .</p>
<p>最后一个字段包含要执行的命令，如果尚未声明shell的环境变量，则该命令将由 /bin/sh 执行。如果命令中包含未转义的百分比符号(%),则该百分比符号将被当作新行，且百分比符号之后的所有内容将反馈到stdin 中的命令。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0 9 2 2 * /usr/<span class="built_in">local</span>/bin/yearly\_bakcup    <span class="comment">#在每年的2月2上午9点整执行命令 /usr/local/yearly\_backup</span></span><br><span class="line">*/7 9-16 * Jul 5 <span class="built_in">echo</span> <span class="string">"China"</span>      <span class="comment">#在七月每周五的上午9点 和下午5点之间，每七分钟向该作业的所有者发送包含单词的 China 的电子 邮件</span></span><br><span class="line">58 23 * * 1-5 /usr/<span class="built_in">local</span>/bin/daily\_report    <span class="comment">#在每个工作日午夜前2分钟运行命令/usr/local/daily\_report</span></span><br><span class="line">0 9 * * 1-5 mutt -s <span class="string">"Checking in"</span> boss@example.com % Hi there boss ,just checking <span class="keyword">in</span> . </span><br><span class="line"><span class="comment">#在每个工作日（周一到周五）的上午9点整，使用mutt 向 boss@example.com 发送邮件。</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[student@desktop0 ~]$ crontab -e</span><br><span class="line">no crontab <span class="keyword">for</span> student - using an empty one</span><br><span class="line">crontab: installing new crontab</span><br><span class="line">[student@desktop0 ~]$ crontab -l</span><br><span class="line">*/2 9-16 * * 1-5 date &gt;&gt; /home/student/my_first_cron_job</span><br><span class="line">[student@desktop0 ~]$ cat my_first_cron_job </span><br><span class="line">Tue May  8 17:10:02 CST 2018</span><br><span class="line">[student@desktop0 ~]$ crontab -r</span><br><span class="line">[student@desktop0 ~]$ crontab -l</span><br><span class="line">no crontab <span class="keyword">for</span> student</span><br><span class="line">[student@desktop0 ~]$</span><br></pre></td></tr></table></figure>
<p><strong>计划系统cron作业</strong></p>
<p>除了用户cron作业外，还有系统cron作业，系统cron作业不是使用crontab 命令定义的，而是在一组配置文件中配置的。这些配置文件之间主要区别在于一个额外的的字段，该字段位置位置星期几和命令字段之间，指定了作业应在哪个用户下运行。</p>
<p>/etc/crontab 的随附注释中包含了实用的语法图</p>
<p><img src="/2018/05/14/rh134-e7-ac-ac-e5-9b-9b-e7-ab-a0-e8-ae-a1-e5-88-92-e5-b0-86-e6-9d-a5-e7-9a-84linux-e4-bb-bb-e5-8a-a1/1525771056304457.png" alt="image.png"></p>
<p>系统作业配置文件在 /etc/crontab 和 /etc/cron.d/* .安装cron 作业的软件包应当通过在/etc/cron.d/ 中放置文件才能执行安装操作，但是，管理员还可以使用此位置来更轻松的将相关作业分到单个文件中，或者使用配置管理系统推送作业。</p>
<p>还有预定义作业每小时，每天、每周和每月运行一次，这个作业将分别执行位于/etc/cron.hourly/ 、/etc/cron.daily/、/etc/cron.weekly 和 /etc/cron.monthly/ 中的所有脚本，请注意，这些目录包含可执行脚本，而不包含cron配置文件 。</p>
<p>/etc/cron.hourly/* 脚本是使用run-parts 命令从/ec/cron.d/0hourly 中定义的作业执行的，每日、每周和每月的作业也使用run-parts命令执行，但是人其它配置文件 /etc/anacrontab 执行。  </p>
<p>过程anacrontab 是由单独的守护进程(anacron)处理的，但是在RHEL 7 中，该文件由常规crond 守护进程解析。该文件旨在确保重要的作业始终运行，且不会因为系统在应执行作业时关闭或休眠而意外跳过。</p>
<p>/etc/anacrontab 的语法与其它cron 配置文件有所不同。它每行正好包含四个字段：</p>
<p>Period in days    #每多少天运行一次<br>Delay in minutes     #在启动该作业前，cron守护进程应等待的时间<br>Job identifier     #此为 /var/spool/anacron/ 中文件的名称，该文件将用于检查该作业是否已运行。在cron 从/etc/anacrontab 启动作业时，它会更新此文件的时间戳。同一时间戳可用于检查 作业上次运行的时间。<br>Command    #要执行的命令</p>
<p>/etc/anacrontab 还包含使用语法 NAME=value 的环境变量声明，特别相关的是 START_HOURS_RANGE: 作业不会在些范围外启动。</p>
<p><strong>管理临时文件</strong></p>
<p>使用systemd-tmpfiles 管理临时文件</p>
<p>用户高度可见的临时文件和目录（常规用户所使用和滥用的/tmp）  </p>
<p>特定于任务的历史文件和目录（例如守护进程以及/run下特定用户的易失性目录，易失性的文件值存在内存中，在系统重启或断电时，所有内容都会丢失。）</p>
<p>为保持系统充分运行，有必要创建那些不存在的目录和文件，因为守护进程可能会依靠它们存在，而清除旧文件后就不会填满磁盘空间或提供错误信息。</p>
<p>旧版本中，系统管理员依靠RPM软件包和systemV初始脚本来创建这些目录，依靠名为tmpwatch的工具来配置目录中删除未使用的旧文件。在RHEL7 中，systemd 提供了一个更加结构化的可配置方法来管理临时目录和文件，systemd-tmpfiles.</p>
<p>在systemd启动系统后，其中一个启动的服务单元是systemd-tmpfiles-setup。该服务运行命令：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemd-tmpfiles --create</span><br><span class="line">systemd-tmpfiles --remove</span><br><span class="line">systemd-tmpfiles --clean</span><br></pre></td></tr></table></figure></p>
<p>该命令会从 /usr/lib/tmpfiles.d/*.conf、/run/tmpfiles.d/*.conf 和 /etc/tmpfiles.d/*.conf 读取配置文件。系统将会删除这些配置文件中标记要删除的任何文件和目录，并且会创建标记要创建（或修复权限）的任何文件和目录，并使其拥有正确的权限（如有必要）</p>
<p><strong>定期清理</strong></p>
<p>为确保长期运行的系统不会用陈旧数据填满磁盘，也有一个systemd 定时器单元会按固定间隔调用systemd-tmpfiles –clean </p>
<p>systemd 定时器单元是一类特殊的systemd服务，它有一个[Timer]块会指示同名服务的启动频率。</p>
<p>在RHEL 7 系统中，systemd-tmpfiles-clean.timer 单元的配置如下所示：</p>
<p><img src="/2018/05/14/rh134-e7-ac-ac-e5-9b-9b-e7-ab-a0-e8-ae-a1-e5-88-92-e5-b0-86-e6-9d-a5-e7-9a-84linux-e4-bb-bb-e5-8a-a1/1526219726507971.png" alt="blob.png"></p>
<p>这表示同名服务（systemd-tmpfiles-clean.service）将在systemd启动15分钟后启动，然后每隔24小时启动一次。</p>
<p>命令systemd-tmpfiles –clean 解析的配置文件与systemd-tmpfiles –create 相同，但前者不会创建文件和目录，而是会清楚在比配置文件中定义的最长期限更近的时间尚未访问、更改或修改的所有文件。</p>
<p><strong>tip:</strong></p>
<p>man page tmpfiles.d(5)声称，系统会删除时间“长于”配置文件中日期字段的期限文件。这并不完全正确。</p>
<p>Linux 文件系统中遵循PSOSIX标准的文件有三个时间戳：atime(上次访问文件的时间)、mtime（上次修改文件内容的时间）、以及 ctime （上次由 chown 、chmod等更改文件状态的时间）。大多数 Linux 文件系统都没有创建时间戳。这在类似Unlix 的文件系统中很常见。</p>
<p>如果这三个时间戳比systemd-tmpfiles期限配置都旧，则文件将会被视为未使用。如果其中任一时间戳比期限配置新，则根据systemd-tmpfiles的期限将不会删除文件。</p>
<p>可以在文件上运行stat 命令(stat filename)，以查看所有这三个时间戳的值，ls -l 命令通常会显示mtime。</p>
<p><strong>systemd-tmpfiles 配置文件</strong></p>
<p>tmpfiles.d(5) 手册中详述了system-tmpfiles的配置文件格式</p>
<p>基本语法由七列构成：“类型”、“路径”、“模式”、UID、GID、“期限”和“参数”。“类型”指的是systemd-tmpfiles应执行的操作；例如 d 表示创建还不存在的目录，或者 Z 表示以递归方式恢复SElinux 上下文以及文件权限和所有权。  </p>
<p>d /run/systemd/seats 0755 root root -<br>#在创建文件和目录是，如果目录/run/systemd/seats还不存在，则创建该目录，所有者为用户root和组root,权限设置为 rwxr-xr-x.系统不会清除该目录。<br>D /home/student 0700 student student 1d<br>#如果目录/home/student 还不存在，请创建该目录。如果存在，则清空其所有内容。运行systemd-timpfiles –clean 时，删除在超过一天时间内尚未被访问、更改或修改过的所有文件<br>L /run/fstablink - root root /etc/fastab<br>#创建指向/etc/fstab的符号链接 /run/fstablink 。绝对不要自动清除这一行。</p>
<p>配置文件优先级，配置文件位置可位于三个位置：</p>
<p>/etc/tmpfiles.d/<em>.conf<br>/run/tmpfiles.d/</em>.conf<br>/usr/lib/tmpfiles.d/*.conf</p>
<p>/usr/lib/tmpfiles.d/ 中的文件是由相关RPM软件包提供的，不应该由系统管理员进行编辑。</p>
<p>/run/tmpfiles.d/ 下的文件本身是易失性文件，通常有守护进程用来管理自己运行时的临时文件。</p>
<p>/etc/tmpfiles.d/ 下的文件旨在供管理员配置自定义临时位置，以及覆盖供应商提供的默认值。</p>
<p>如果出现同名配置文件优先权依次是： /etc/tmpfiles.d/ &gt;&gt; /run/tmpfiles.d/ &gt;&gt; /usr/lib/tmpfiles.d/ 。</p>
<p>给定优先权规则后，管理员将相关文件复制到/etc/tmpfiles.d/ 然后编辑该配置文件，即可轻松覆盖供应商提供的设置。如果以这种方式工作，则确保可从中央配置管理系统轻松管理管理员提供的设置，并且软件包的更新不会覆盖这些设置。  </p>
<p>在测试新配置或修改后的配置时，对于仅在一个配置文件外应用命令会十分有用。在命令行中指定配置文件中的名称即可实现这一点。</p>
<p>systemd-tmpfiles –creat tmp.conf    #测试tmp.conf文件<br>systemd-tmpfiles –clean tmp.conf</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/14/rh134-e7-ac-ac-e5-9b-9b-e7-ab-a0-e8-ae-a1-e5-88-92-e5-b0-86-e6-9d-a5-e7-9a-84linux-e4-bb-bb-e5-8a-a1/" data-id="cjqlgp08y0023qtkjf77ddhze" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-rh134-e7-ac-ac-e4-b8-89-e7-ab-a0-e4-bd-bf-e7-94-a8vim-e5-88-9b-e5-bb-ba-e5-92-8c-e7-bc-96-e8-be-91-e6-96-87-e6-9c-ac-e6-96-87-e4-bb-b6" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/08/rh134-e7-ac-ac-e4-b8-89-e7-ab-a0-e4-bd-bf-e7-94-a8vim-e5-88-9b-e5-bb-ba-e5-92-8c-e7-bc-96-e8-be-91-e6-96-87-e6-9c-ac-e6-96-87-e4-bb-b6/" class="article-date">
  <time datetime="2018-05-08T03:07:04.000Z" itemprop="datePublished">2018-05-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/RHEL134/">RHEL134</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/08/rh134-e7-ac-ac-e4-b8-89-e7-ab-a0-e4-bd-bf-e7-94-a8vim-e5-88-9b-e5-bb-ba-e5-92-8c-e7-bc-96-e8-be-91-e6-96-87-e6-9c-ac-e6-96-87-e4-bb-b6/">RH134 第三章 使用VIM创建和编辑文本文件</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>当非特权用户在RHEL7 计算机上使用vi时，执行的命令将是vim。这是在shell 启动时通过/etc/profile.d/vim.sh 中设置的别名完成的。  </p>
<p>对于 UID 小于或等于200的用户，没有设置这一别名。这些用户将执行vi，也就是vi兼容模式中的vim。这意思意味了典型vi中没有的功能将被禁用。在需要较新的功能时，建议始终执行vim 命令。而不要依赖不一定可用的别名。用户通常需要以root身份操作时尤其需要这么做。</p>
<p><strong>三种不同版本的vim   
</strong></p>
<p>vim-minimal:仅提供vi功能和相关命令，此版本包括在RHEL7最小化安装里。</p>
<p>vim-enhanced：此版本提供vim命令，提供表达式，高亮，文件类型插件，和拼写检查</p>
<p>vim-X11：此版本提供gvim 图形化的vim.同时支持鼠标</p>
<p><strong>vim 的三个主要模式：</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">功能</th>
<th>模式</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">命令模式</td>
<td>此模式用于文件导航，剪切和粘贴以及简单命令。 撤销，重做和其他操作也可以从此模式执行</td>
</tr>
<tr>
<td style="text-align:left">插入模式</td>
<td>此模式用于正常文本编。替换模式是插入模式的一种变体，替换文本而不是插入文本。</td>
</tr>
<tr>
<td style="text-align:left">执行模式</td>
<td>此模式用于保存，退出和打开文件，以及搜索和替换等更复杂的操作。从这种模式中，可以将程序的输出插入到当前文件中.配置 vim等等。 任何操作都有可能可能使用ex这个模式完成。</td>
</tr>
</tbody>
</table>
<p>打开文件后，vim将在命令模式中启动。将在屏幕左下角看到有关已打开文件信息（文件名、行数、字符数），并将在右下角看到当前的光标位置（行、字符）以及正在显示文件的哪个部分（ALL表示全部，Top表示文件前几行，Bot 表示文件底部），或者显示百分比来表示当前所处文件位置。最下方线条在vim术语中称为标尺。  </p>
<p>要切换到插入模式，系统提供了可用的命令，且每个命令在键盘上均分配有一个不同的键</p>
<table>
<thead>
<tr>
<th style="text-align:left">键</th>
<th>结果</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">i</td>
<td>切换到插入模式，并在当前光标位置之前插入</td>
</tr>
<tr>
<td style="text-align:left">a</td>
<td>切换到插入模式，并在当前光标位置之后插入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td>将光标移至当前行的开头位置，并切换到插入模式</td>
</tr>
<tr>
<td style="text-align:left">A</td>
<td>将光标移到当前行的结尾位置，并切换到插入模式</td>
</tr>
<tr>
<td style="text-align:left">R</td>
<td>从光标下的字符开始，切换到替换模式。处理替换模式时，不会插入文件，输入的每个字符均将替换当前文档中的字符。</td>
</tr>
<tr>
<td style="text-align:left">o</td>
<td>在当前行的下方新打开一个行，并切换到插入模式。</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td>在当前行的上方新打开一个行，并切换到插入模式。</td>
</tr>
</tbody>
</table>
<p>每次处于插入或替换模式时，标尺将会显示–INSERT– 或 –REPLACE–。按Esc 即可返回命令模式。</p>
<p>RHEL 随附的vi和vim 版本已经配置为在命令和插入模式中识别和使用常规光标键以及如PgUp和End等键，这并不是vi所有安装版本上的默认行为。事实上，之前版本的vi根本不识别光标键，而是只允许在命令模式中使用诸如hjkl的键来操作。  </p>
<p><strong>vim光标操作</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">键</th>
<th>结果</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">h</td>
<td>向左移动一个位置</td>
</tr>
<tr>
<td style="text-align:left">l</td>
<td>向右移动一个位置</td>
</tr>
<tr>
<td style="text-align:left">j</td>
<td>向下移动一下位置</td>
</tr>
<tr>
<td style="text-align:left">k</td>
<td>向上移动一个位置</td>
</tr>
<tr>
<td style="text-align:left">^</td>
<td>移至当前行首</td>
</tr>
<tr>
<td style="text-align:left">$</td>
<td>移至当前行尾</td>
</tr>
<tr>
<td style="text-align:left">gg</td>
<td>移至文件第一行</td>
</tr>
<tr>
<td style="text-align:left">G</td>
<td>移至文件最后一行</td>
</tr>
</tbody>
</table>
<p>保存文件通过ex模式实现，在命令模式下按  :（冒号）进入 ex模式</p>
<table>
<thead>
<tr>
<th style="text-align:left">键</th>
<th>结果</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">:wq</td>
<td>保存并退出当前文件</td>
</tr>
<tr>
<td style="text-align:left">: x</td>
<td>保存当前文件（如果存在未保存的更改），然后退出</td>
</tr>
<tr>
<td style="text-align:left">:w</td>
<td>保存当前文件并保留在编辑器中</td>
</tr>
<tr>
<td style="text-align:left">:w <filename></filename></td>
<td>以其他文件名保存当前文件</td>
</tr>
<tr>
<td style="text-align:left">:q</td>
<td>退出当前文件（仅在没有未保存更改的的情况下）</td>
</tr>
<tr>
<td style="text-align:left">:q!</td>
<td>退出当前文件，忽略任何未保存更改，！表示强制</td>
</tr>
<tr>
<td style="text-align:left">:3</td>
<td>跳到第3行</td>
</tr>
</tbody>
</table>
<p>高级移动命令，仅在命令模式中可用，所有移到命令可以通过键入数字来加上前缀，如5w,将光标移动5个单词，或者12j将光标向下移到12行。实际上，每个命令（包括切换到插入模式）都可通过实际命令前键入重复次数来重复执行一定的次数，在vim术语中，这称为计数。  </p>
<table>
<thead>
<tr>
<th style="text-align:left">键</th>
<th>结果</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">w</td>
<td>将光标移到下一单词的开头（w包含标点符号）</td>
</tr>
<tr>
<td style="text-align:left">b</td>
<td>将光标移到上一单词的开头（b包含标点符号）</td>
</tr>
<tr>
<td style="text-align:left">(</td>
<td>将光标移到当前或上一句子的开头</td>
</tr>
<tr>
<td style="text-align:left">)</td>
<td>将光标移到下一句子的开头</td>
</tr>
<tr>
<td style="text-align:left">{</td>
<td>将光标移到当前/上一段落的开头</td>
</tr>
<tr>
<td style="text-align:left">}</td>
<td>将光标移到下一段落的开头</td>
</tr>
</tbody>
</table>
<p>替换文本，vim允许用户通过”change”命令替换大量（或少量）文件。”change”命令的使用方式为：按 c 键，后面加上光标移动；例如cw可以将当前光标位置更改到当前单词的末尾。要替换的文本被删除（放置在未命名寄存器中），vim 也会切换到插入模式。  </p>
<p>按c 两下（cc）将开始以行范围的方式替换，即替换一整行（或者带上数字时替换多行）同样的操作也适用于删除（d）</p>
<p>大多数移动命令可以带上i和a前缀，以选择inner 或a 版本的移动。例如ciw将替换整个当前单词，而不仅仅是从当前光标位置起，而caw则执行相同的功能，但包括周围任何空白区。</p>
<p>要替换到行末为止，可以使用cS，但C可执行相同的功能。（同样适用于删除命令（D））</p>
<p>要权替换光标处的字符，可按r再键入新的字符</p>
<p>要改变光标处字符的大小写，或按 ~</p>
<p>删除文本的操作方式与替换文本相同。用于删除文本的命令是d,而且对更改文本有效的所有相同移到也适用于删除，包括D可以删除光标位置到行末的内容。</p>
<p><strong>复制和粘贴</strong>  </p>
<p>vim 用于描述复制和粘贴操作的术语与大多数人目前熟悉的稍有不同，复制操作也称为拖拉，而粘贴操作则叫做放置，这体现在分配给这些操作的键盘命令上：拖拉是y加上移到，而放置操作则通过p和P执行。</p>
<p>拖拉操作遵循与替换和删除操作相同的通用方案：如用户可以选择键入要重复某一操作的次数，后面加上y，再加上一种移到。例如5yaw，将复制当前的单词，以及后面4个单词（共5个）.按yy将拖拉一整行，等等</p>
<p>放置（粘贴）通过p和P命令执行；小写p将内容放置到当前光标位置的后面（如果粘贴是的是行范围数据，则放在当前行下面），而大写P则放置到当前光标位置的前面或者当前行上方。与所有其它命令一样，放置命令可以加上寄存器粘贴次数作为前缀。</p>
<p><strong>多个寄存器</strong></p>
<p>vim 不是仅提供一个供复制和粘贴 使用的剪贴板，而是提供26个命名寄存器，以及欠点特殊用途的寄存器。拥有多个寄存器可以让用户更加高效地很乖剪切和粘贴命令，而不必担心丢失数据，或者过多的移动光标。如果未指定要使用的寄存器，则将使用“未命名”寄存器。常规寄存器称为a到z,通过在命令的计数和实际命令之间放入”registername来选择，例如：要复制当前行和后面2行到t寄存器中，用户可以使用3”tyy</p>
<p>要放置命名寄存器中的内容，只需要在放置命令之前加上”registername，例如：”sp将在光标位置后面放置s寄存器中的内容。</p>
<p>每次使用命名寄存器时，未命名寄存器也会更新。</p>
<p>删除和更改操作也可加上寄存器选择作为前缀。未指定寄存器时，将仅使用未命名寄存器。当使用寄存器的大写版本时，被剪切或拖拉的文本将附加到该寄存器，而不是覆盖它。</p>
<p><strong>特殊寄存器</strong></p>
<p>有10个数字编号的寄存器，分别为”0 - “9寄存器，”0使用拥有最近拖拉文本的副本，而寄存器”1则具有最近删除的文本的副本。当新的文本补更改或删除时，”1的内容将移到”2中，”2的内容移动”3中，以此类推。与命名寄存器不同，数字编号寄存器的内容不会在会话之间保存。</p>
<p><strong>可视模式</strong></p>
<p>在进入可视模式后（通过标尺–VISUAL–表示），任何光标移动将开始选择文本。可视模式中发出的任何更改、删除或拖拉命令不需要光标移动部分，而是对选定的文件起作用。</p>
<p>可视模式有三个类别：基于字符（通过 v 启动）、基于行（通过 V 启动） 、基于块（通过 Ctrl+v 启动）。使用gvim时，也可通过鼠标选择文本。</p>
<p>可视模式中发出的任何ex 命令也默认对选定的文本起作用。</p>
<p><strong>搜索</strong></p>
<p>在当前文档中搜索可能通过两种方式：按 / 键从光标处向前搜索，或者按 ？从当前光标位置向后搜索。进入搜索模式后，可以键入要搜索的正则表达式，然后按Enter 键跳到第一个匹配项。</p>
<p>要搜索下一个或者上一个匹配项可分别按 n 和 N 键。</p>
<p>奖励快捷方式：* 将立即向前搜索光标处的单词。</p>
<p><strong>搜索和替换</strong></p>
<p>vim 中的搜索和替换通过 ex 命令实施，其使用的语法与用户通过sed 搜索和替换时所用的相同，包括使用正则表达式进入搜索的功能：</p>
<p>ranges/pattern/string/flags</p>
<p>range 可以是行号（43）、行范围（1，7 表示1 - 7行）、搜索条件（/README\.txt）、%(当前文档中的所有行；搜索和替换通常仅会对当前行操作)，或者’&lt;,’&gt;(当前的可视选择)。</p>
<p>两个最常见的flaga 是 g （替换一行中多个位置上的pattern） 和 i  （使当前的搜索区分大小写）</p>
<p>:%s/\&lt;cat\&gt;/god/gi     #搜索文档中每个位置的cat ，并替换成dog ，不区分大小写，但仅对完整的词语，而不是诸如：”catalog” 中的一部分。</p>
<p><strong>撤消和恢复</strong></p>
<p>为了允许人为的失误存在，vim配备了撤消/恢复机制。只要在命令模式中按u 即可撤消最近一个操作。如果撤消了过多操作，按 Ctrl + r 即可恢复最近一次撤消。</p>
<p>奖励诀窍：从命令模式中按 . (句号 英文)将对当前恢复最近一个编辑操作。这可以用于对多个行轻松执行同一编辑操作。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/08/rh134-e7-ac-ac-e4-b8-89-e7-ab-a0-e4-bd-bf-e7-94-a8vim-e5-88-9b-e5-bb-ba-e5-92-8c-e7-bc-96-e8-be-91-e6-96-87-e6-9c-ac-e6-96-87-e4-bb-b6/" data-id="cjqlgp08h001nqtkj3dmnd85d" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-e7-ac-ac-e4-ba-8c-e7-ab-a0-e9-80-9a-e8-bf-87grep-e4-bd-bf-e7-94-a8-e6-ad-a3-e5-88-99-e8-a1-a8-e8-be-be-e5-bc-8f" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/06/e7-ac-ac-e4-ba-8c-e7-ab-a0-e9-80-9a-e8-bf-87grep-e4-bd-bf-e7-94-a8-e6-ad-a3-e5-88-99-e8-a1-a8-e8-be-be-e5-bc-8f/" class="article-date">
  <time datetime="2018-05-06T06:15:16.000Z" itemprop="datePublished">2018-05-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/RHEL134/">RHEL134</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/06/e7-ac-ac-e4-ba-8c-e7-ab-a0-e9-80-9a-e8-bf-87grep-e4-bd-bf-e7-94-a8-e6-ad-a3-e5-88-99-e8-a1-a8-e8-be-be-e5-bc-8f/">RH134 第二章 通过GREP使用正则表达式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h6 id="行定位符：行首-行尾"><a href="#行定位符：行首-行尾" class="headerlink" title="行定位符：行首 ^ 行尾 $"></a>行定位符：行首 ^ 行尾 $</h6><p>^cat 匹配cat 开头的行</p>
<p>dog$ 匹配dog 结尾的行</p>
<p>^cat$    匹配只有cat的行</p>
<p>另一种定位符是字边界。\&lt;和\> 可分别用于匹配一个字词的开头和结尾</p>
<h6 id="通配符和倍数"><a href="#通配符和倍数" class="headerlink" title="通配符和倍数"></a>通配符和倍数</h6><p>正则表达式使用 “.”作为无限制通配符。 正则表达式 c.t 将会依次查找包含 c、任一字符和 t 的数据。比如：cat ,cot ,c5t ,cQt 等等。</p>
<p>有限制通配[ ] ,如c[aou]t ，匹配出来的的结果只能包括cat ,cot ,cut 。</p>
<p>倍数与通配符一起使用可以匹配多个字符。“*”在证据表达式中修饰它前一位字符，从表示该字符的数量可为0至无限大。如果使用正则表达式c.*t 将会匹配 cat ,cot,coat,culvert 等以c开头t结尾的，中间包含任意多个字符的数据。</p>
<p>另一种倍数将会指示模式中前面字符的期望个数。c.\{2\}t是使用显式倍数的一个示例。此正则表达式将会匹配以 c 开头，以 t 结尾且中间包含两个任意两个字符的数据。</p>
<p>在不同的脚本语言中，正则表达式的语法会存在些许差异。</p>
<h6 id="使用grep"><a href="#使用grep" class="headerlink" title="使用grep"></a>使用grep</h6><p>grep是用作部分分发的一个命令，其使用正则表达式来隔离匹配的数据。</p>
<p>grep ‘cat$’ /usr/share/dict/words</p>
<p>注意：由于正则表达式常含有shell 元字符（如$、* 等），建议练习的时候使用单引号（‘’）来括起命令行上的正则表达式。</p>
<p>ps aux | grep ‘^student’    #通过使用 | ，grep 可以与其它命令一起使用。</p>
<table>
<thead>
<tr>
<th style="text-align:left">选项</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">-i</td>
<td>使用所提供的正则表达式；但是不会强制区分大小写（运行不区分大小写的操作）。</td>
</tr>
<tr>
<td style="text-align:left">-v</td>
<td>仅显示不包含正则表达式匹配项的行。</td>
</tr>
<tr>
<td style="text-align:left">-r</td>
<td>将递归匹配正则表达式的数据搜素应用到一组文件或目录中。</td>
</tr>
<tr>
<td style="text-align:left">-A <number></number></td>
<td>显示正则表达式匹配项之后的行数</td>
</tr>
<tr>
<td style="text-align:left">-B <number></number></td>
<td>显示正则表达式匹配项之后的行数</td>
</tr>
<tr>
<td style="text-align:left">-e</td>
<td>如果使用多个-e选项，则提供多个正则表达式，并将与逻辑or一起使用</td>
</tr>
</tbody>
</table>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">grep -i <span class="string">'cat'</span> file    <span class="comment">#不区分大小写</span></span><br><span class="line">grep -i -v <span class="string">'cat'</span> file    <span class="comment">#不显示带有cat（大小写）的内容</span></span><br><span class="line">grep -v <span class="string">'^\[#;\]'</span> file    <span class="comment">#不显示以#或者；开头的行</span></span><br><span class="line">grep -e <span class="string">'cat'</span> -e <span class="string">'dog'</span> file     <span class="comment">#显示包含cat 或者dog的行</span></span><br><span class="line">grep <span class="string">'^Aug *8 1\[345\]'</span> door.log     <span class="comment">#查找8月8日，13点-15点分发生的事</span></span><br><span class="line">grep <span class="string">'^Aug \*8 14.\*OPEN'</span> door.log     <span class="comment">#找8月8日14点的包含OPEN的信息</span></span><br><span class="line">grep <span class="string">'^Aug *8 14:\[345\]'</span> wall.log 27  <span class="comment">#查找8月8日，14点30-50分发生的事</span></span><br><span class="line">grep <span class="string">'^Aug \*8 14.\*ALERT'</span> wall.log 28  <span class="comment">#查找8月8日14点的包含ALERT的信息</span></span><br><span class="line">grep <span class="string">'^Aug *8 14:40'</span> proxy.log     <span class="comment">#查找8月8日 14:40分发生的事</span></span><br><span class="line">grep -A 24 <span class="string">'14:40'</span> proxy.log    <span class="comment">#查找匹配之后的24行</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/06/e7-ac-ac-e4-ba-8c-e7-ab-a0-e9-80-9a-e8-bf-87grep-e4-bd-bf-e7-94-a8-e6-ad-a3-e5-88-99-e8-a1-a8-e8-be-be-e5-bc-8f/" data-id="cjqlgp06a000uqtkjlsywg2go" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-rh134-e7-ac-ac-e4-b8-80-e7-ab-a0-e4-bd-bf-e7-94-a8kickstart-e8-87-aa-e5-8a-a8-e5-ae-89-e8-a3-85" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/05/rh134-e7-ac-ac-e4-b8-80-e7-ab-a0-e4-bd-bf-e7-94-a8kickstart-e8-87-aa-e5-8a-a8-e5-ae-89-e8-a3-85/" class="article-date">
  <time datetime="2018-05-05T05:24:56.000Z" itemprop="datePublished">2018-05-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/RHEL134/">RHEL134</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/05/rh134-e7-ac-ac-e4-b8-80-e7-ab-a0-e4-bd-bf-e7-94-a8kickstart-e8-87-aa-e5-8a-a8-e5-ae-89-e8-a3-85/">RH134 第一章 使用kickstart自动安装</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Kickstart 配置文件以一个命令列表开关，这些命令定义将如何安装目录计算机。以#字符开关的行是安装程序将会忽略的注释。其它部分开头是以%字符打头的行，结尾是包含%end指令的行。</p>
<p>%packages 部分指定要在目标系统上安装的软件，单个软件包可以根据名称（不带版本）指定。</p>
<p>软件包组可以根据名称或ID指定。并以@字符开关。</p>
<p>环境组（软件包组的组）可使用@^ 指定，后面紧跟环境组名或ID。组具有必需、默认和可选组件。通常kickstart 将安装必需组件和默认组件。</p>
<p>以 - 字符开头的软件包或组名将补排除在安装以外，除非它们为必需，或因其它软件包的RPM依赖关系而安装。</p>
<p>还有两个部分是%pre 和%post 脚本。%post 更为常见。它在所有软件都已安装后对系统进程配置。%pre 脚本在进行任何磁盘分区之前执行。</p>
<p>必需先指定配置命令。%pre 、 %post 和%packages 可以在配置命令之后以任何顺序出现。  </p>
<h4 id="kickstart-配置文件命令"><a href="#kickstart-配置文件命令" class="headerlink" title="kickstart 配置文件命令"></a>kickstart 配置文件命令</h4><h5 id="安装命令"><a href="#安装命令" class="headerlink" title="安装命令"></a>安装命令</h5><h6 id="url-指定安装介质位置"><a href="#url-指定安装介质位置" class="headerlink" title="url:指定安装介质位置"></a>url:指定安装介质位置</h6><p>url –url=”<a href="ftp://install" target="_blank" rel="noopener">ftp://install</a> server.example.com/pub/RHEL7/dvd”</p>
<p>repo : 此选项告知Anaconda 在何处查找安装软件包。此选项必须指向有效的yum 存储库。</p>
<p>repo –name=”Custom Packages” –baseurl=”<a href="ftp://repo.example.com/custom&quot;" target="_blank" rel="noopener">ftp://repo.example.com/custom&quot;</a></p>
<p><a href="http://ftp://repo.example.com/custom&quot;" target="_blank" rel="noopener"></a>  </p>
<p>text: 强制进行文本模式安装</p>
<p>vnc:允许通过VNC远程查看图形安装。</p>
<p>vnc –password=redhat</p>
<p>askmethod:当CD-ROM 驱动器中检测到安装介质时，不自动使用CD-ROM作为软件包来源。</p>
<h6 id="分区命令："><a href="#分区命令：" class="headerlink" title="分区命令："></a>分区命令：</h6><p>clearpart:在安装之前清除指定分区</p>
<p>clearpart –all –drives=sda,sdb –initlabel</p>
<p>part: 指定分区大小、格式、名称</p>
<p>part /home –fstype=ext4 –label=homes –size=4096 –maxsize=8192 –grow</p>
<p>ignoredisk: 安装的时候忽略指定盘</p>
<p>ignoredsk –drives=sdc</p>
<p>bootloader :定义安装引导分区</p>
<p>bootloader –location=mbr –boot-drive=sda</p>
<p>volgroup,logvol: 创建LVM卷组和逻辑卷</p>
<p>part pv.01 –size=8192<br>volgroup myvg pv.01<br>logvol / –vgname=myvg –fstype=xfs –size=2048 –name=rootvol –grow<br>logvol /var –vgname=myvg –fstype=xfs –size=4096 –name=varvol</p>
<p>zerombr: 格式未被识别的磁盘将被初始化。</p>
<h6 id="网络命令"><a href="#网络命令" class="headerlink" title="网络命令"></a>网络命令</h6><p>network:配置目标系统的网络信息，并激活安装程序环境中的网络设备。</p>
<p>network –device=eth0 –bootproto=dhcp</p>
<p>firewall : 此选项定义在目标系统上如何配置防火墙</p>
<p>firewall –enabled –service=ssh,cups</p>
<h5 id="配置命令："><a href="#配置命令：" class="headerlink" title="配置命令："></a>配置命令：</h5><p>lang : 此必需命令设置安装时需要使用的语言和已经安装系统的默认语言</p>
<p>lang en_US.UTF-8</p>
<p>keyboard: 此必需命令，设置系统键盘类型。</p>
<p>keyboard –vckeymap=us –xlayouts=’us’,’us’</p>
<p>timezone :定义时区、NTP server及硬件时钟是否使用UTC</p>
<p>timezone –utc –ntpservers=time.example.com Europe/amsterdam</p>
<p>auth: 此必需选项设置系统身份认证选项</p>
<p>auth –useshadow –enablemd5 –passalgo=sha512</p>
<p>rootpw: 定义root初始密码</p>
<p>rootpw –plaintext redhat    #明文<br>rootpw –iscrypted $6$KUnFfrTzOBjv.PiH$YlBbOtXBkWzoMuRfb0.SpbQ….XDR1UuchoMG1    #加密</p>
<p>selinux : 设置安装系统后selinux状态</p>
<p>selinux –enforcing</p>
<p>services : 修改默认运行级别下将运行的默认服务集合。</p>
<p>services –disabled=network,iptables,ip6tables –enabled=NetworkManager,firewalld</p>
<p>group,user :在系统上创建本地用户和组</p>
<p>group –name=admins –gid=1001<br>user –name=jode –gecos=”john doe” –groups=admins –password=changeme –plaintext</p>
<h5 id="杂项命令："><a href="#杂项命令：" class="headerlink" title="杂项命令："></a>杂项命令：</h5><p>logging :此命令定义安装期间Anaconda 将如何进行日志记录。</p>
<p>logging –host=loghost.example.com –level=info</p>
<p>firstboot: 确定系统首次启动时firestboot 是否启动</p>
<p>firstboot –disabled</p>
<p>reboot、poweroff 、halt ： 指定安装结束后就发生什么情况。  </p>
<p>pykickstart软件包中的ksverdiff 程序可以识别两个版本间kickstart文件语法中的区别，如ksverdiff -f RHEL6 -t RHEL7 ,将识别RHEL6到RHEL7 的语法更改。可用版本在/usr/lib/python2.7/sit-packages/pykickstart/version.py。yum install pykickstart 。  </p>
<hr>
<p>命令部分参考：</p>
<p><img src="/2018/05/05/rh134-e7-ac-ac-e4-b8-80-e7-ab-a0-e4-bd-bf-e7-94-a8kickstart-e8-87-aa-e5-8a-a8-e5-ae-89-e8-a3-85/1525422261580488.png" alt="图片.png"></p>
<p>安装软件部分</p>
<p><img src="/2018/05/05/rh134-e7-ac-ac-e4-b8-80-e7-ab-a0-e4-bd-bf-e7-94-a8kickstart-e8-87-aa-e5-8a-a8-e5-ae-89-e8-a3-85/1525422300234129.png" alt="图片.png"></p>
<p>配置脚本部分</p>
<p><img src="/2018/05/05/rh134-e7-ac-ac-e4-b8-80-e7-ab-a0-e4-bd-bf-e7-94-a8kickstart-e8-87-aa-e5-8a-a8-e5-ae-89-e8-a3-85/1525422328135998.png" alt="图片.png"></p>
<p><img src="/2018/05/05/rh134-e7-ac-ac-e4-b8-80-e7-ab-a0-e4-bd-bf-e7-94-a8kickstart-e8-87-aa-e5-8a-a8-e5-ae-89-e8-a3-85/1525422388734744.png" alt="图片.png"></p>
<p>使用system-config-kickstart 创建kickstart文件。或者使用编辑器创建kickstart文件（参考anaconda-ks.cfg 默认在root的家目录下），使用编辑的几种情况：</p>
<p>1、GUI或system-config-kickstart 不可用</p>
<p>2、需要高级磁盘分区配置说明。system-config-kickstart 不支持LVM和RAID</p>
<p>3、需要包含或者忽略单个包（而不仅仅是组）</p>
<p>4、%prc 和%post 需要更高级的脚本。  </p>
<p>ksvalidator 检查配置语法，它将确保关键字和选项的正确使用，无法验证url路径、单个数据包或组，也无法验证%post 和%pre 脚本的任何部分</p>
<h5 id="通过修改系统启动项，指定配置文件。"><a href="#通过修改系统启动项，指定配置文件。" class="headerlink" title="通过修改系统启动项，指定配置文件。"></a>通过修改系统启动项，指定配置文件。</h5><h5 id="启动方式"><a href="#启动方式" class="headerlink" title="启动方式"></a>启动方式</h5><h6 id="指定配置文件方式"><a href="#指定配置文件方式" class="headerlink" title="指定配置文件方式"></a>指定配置文件方式</h6><p>网络服务器,FTP,HTTP,NFS  </p>
<p>ks=<a href="http://server/dir/file" target="_blank" rel="noopener">http://server/dir/file</a>  </p>
<p>ks=<a href="http://ftp://server/dir/file" target="_blank" rel="noopener">ftp://server/dir/file</a>  </p>
<p>ks=nfs:server:/dir/file</p>
<h6 id="USB磁盘或CD-ROM"><a href="#USB磁盘或CD-ROM" class="headerlink" title="USB磁盘或CD-ROM"></a>USB磁盘或CD-ROM</h6><p>ks=hd:device:/dir/file</p>
<p>ks=cdrom:/dir/file  </p>
<p><a href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html/installation_guide/sect-kickstart-syntax" target="_blank" rel="noopener">完整参数介绍</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/05/rh134-e7-ac-ac-e4-b8-80-e7-ab-a0-e4-bd-bf-e7-94-a8kickstart-e8-87-aa-e5-8a-a8-e5-ae-89-e8-a3-85/" data-id="cjqlgp06e0011qtkjjjn4s4is" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pxe/">pxe</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-chapter-6-controlling-access-to-files-with-linux-file-system-permissions" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/03/chapter-6-controlling-access-to-files-with-linux-file-system-permissions/" class="article-date">
  <time datetime="2018-05-03T09:15:19.000Z" itemprop="datePublished">2018-05-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/RHEL124/">RHEL124</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/03/chapter-6-controlling-access-to-files-with-linux-file-system-permissions/">Chapter 6 . Controlling Access to Files with Linux File system Permissions</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Linux-文件系统权限"><a href="#Linux-文件系统权限" class="headerlink" title="Linux 文件系统权限"></a>Linux 文件系统权限</h3><p>文件具体三个应用权限 的用户类别。文件归用户所有，通常是创建文件的用户。文件归单个组所有，通常是创建文件的用户的主要组，但是可以进行更改。可以为所属用户、所属组和系统上的非用户和非所属组的其它用户设置不同的权限。三种应用权限 ：r,w,x（读、写、执行）  </p>
<table>
<thead>
<tr>
<th style="text-align:left">权限</th>
<th>对文件的影响</th>
<th>对目录的影响  </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">r</td>
<td>可以读取文件的内容</td>
<td>可以列出目录的内容（文件名）  </td>
</tr>
<tr>
<td style="text-align:left">w</td>
<td>可以更改文件内容</td>
<td>可以创建或删除目录中的文件  </td>
</tr>
<tr>
<td style="text-align:left">x</td>
<td>可以作为命令执行文件</td>
<td>可以访问目录的内容（取决于目录中文件的权限）  </td>
</tr>
</tbody>
</table>
<p>用户通常对目录具有r,x 权限，因此他们可以列出目录并访问其内容。如果用户只有 r 权限那只能列出文件名，其它信息都不可用。如果用户对目录只有 x 权限。则不能列出目录中的文件名，但是可以对已知文件名并有读取权限的文件通过明确指定文件名来访问文件的内容。对文件具有 w 权限的用户可以删除目录的文件，不论文件所属是谁（特殊权限除外）。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls -l file1    <span class="comment">#查看文件的所有权</span></span><br><span class="line">ls -ld dir     <span class="comment">#查看目录的所有权</span></span><br></pre></td></tr></table></figure></p>
<p>与NTFS权限不同，linux 权限设置适用于设置了linux 权限的目录和文件，目录中的子目录和文件不会继承目录的权限。（但是目录的权限可以会阻止用户访问文件）</p>
<p>更改文件/目录的权限</p>
<h5 id="符号法"><a href="#符号法" class="headerlink" title="符号法"></a>符号法</h5><p>chmod WhoWhatWhich file|dir</p>
<p>Who 是指 u , g , o , a  (代表用户、组、其它、全部)  </p>
<p>What 是指 + , - , = (代表添加、删除、精确设置)  </p>
<p>Which 是指 r , w , x (代表读取、写入、可执行)</p>
<h5 id="数值法"><a href="#数值法" class="headerlink" title="数值法"></a>数值法</h5><p>chmod ### file | dir  </p>
<p>每个数字代表一个访问级别：用户、组、其它</p>
<p># 是 r = 4 , w = 2 , x = 1 的和</p>
<p>使用数值法，权限由3位（或者设置高级权限时4位）八进制数来表示。单一数值范围0-7<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chmod go-rw file1    <span class="comment">#删除组和其它的 r,w 权限</span></span><br><span class="line">chmod a+x file2    <span class="comment">#为每个人添加x 权限</span></span><br><span class="line">chmod 750 sampledir    <span class="comment">#设置用户 rwx ,组 rx  ,其它 - 无权限</span></span><br><span class="line"><span class="comment">#目录树递归设置权限使用 -R 选项。当使用此选项是，务必使用 X 权限，而不是 x 权限 。表示应对目录而不是普通文件设置执行权限。</span></span><br><span class="line">chmod -R g+rwX demodir     <span class="comment">#对demodir 目录及其子目录设置rwx 权限 ，对目录中的文件设置rw 权限</span></span><br></pre></td></tr></table></figure></p>
<h5 id="更改文件-目录的用户或组所有权"><a href="#更改文件-目录的用户或组所有权" class="headerlink" title="更改文件/目录的用户或组所有权"></a>更改文件/目录的用户或组所有权</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chown  student foofile     <span class="comment">#修改文件foofile 的所有都为student</span></span><br><span class="line">chown -R student foodir     <span class="comment">#修改目录及其子文件、目录的所有都为student</span></span><br><span class="line">chown :admins foodri     <span class="comment">#修改目录的所属组为admins</span></span><br><span class="line">chown visitor:guests foodir     <span class="comment">#修改目录的所属者visitor,所属组guests </span></span><br><span class="line"><span class="comment">#只能root用户可以更改文件所有权。但是，root 或文件的所有者可以设置组所有权。root 用户可将所有权授予任何组，非root用户可将所有权授予他们所属的组。</span></span><br></pre></td></tr></table></figure>
<h5 id="默认权限和文件访问"><a href="#默认权限和文件访问" class="headerlink" title="默认权限和文件访问"></a>默认权限和文件访问</h5><h6 id="特殊权限"><a href="#特殊权限" class="headerlink" title="特殊权限"></a>特殊权限</h6><p>对可执行文件的setuid (或setgid)权限表示将以文件所属用户（或组）身份执行，而不是运行命令的用户身份。</p>
<p>目录的粘滞位可以为文件的删除设置特殊权限：仅文件所属者或root用户可以删除。</p>
<p>对于目录的setgid 权限表示 在该目录中创建的文件将继承目录组所属关系，而不是继承自用户。这通常用于组协作目录，将文件从默认的专有组自动更改成共享组。</p>
<table>
<thead>
<tr>
<th style="text-align:left">权限</th>
<th>对文件的影响</th>
<th>对目录的影响  </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">u+s (suid)</td>
<td>以文件所属者身份运行，而非运行命令的用户身份</td>
<td>无  </td>
</tr>
<tr>
<td style="text-align:left">g+s (sgid)</td>
<td>对文件所属组身份执行文件</td>
<td>在目录中最新创建的文件将其所属组设置为和目录所属组相匹配  </td>
</tr>
<tr>
<td style="text-align:left">o+t (sticky)</td>
<td>无</td>
<td>对目录有写入权限的用户仅可删除自己创建的文件，无法删除或强制保存到其它用户拥有的文件  </td>
</tr>
</tbody>
</table>
<h6 id="设置特殊权限"><a href="#设置特殊权限" class="headerlink" title="设置特殊权限"></a>设置特殊权限</h6><p>符号法：setuid = u+s ,setgid = g+s ，sticky = o+t  </p>
<p>数值法：(4位第1位) setuid = 4, setgid = 3 ,sticky =1</p>
<p>chmod g+s dir     #在dir目录添加setgid位<br>chmod 2770 dir     #在dir目录设置setgid，并对目录的用户和组设置 rwx 权限</p>
<h6 id="默认文件权限"><a href="#默认文件权限" class="headerlink" title="默认文件权限"></a>默认文件权限</h6><p>bash shell 用户的默认umask 在/etc/profile 和 /etc/bashrc 文件中定义。用户可以修改家目录下的.profile 和  .bashrc 文件来覆盖系统值。设置umask 少于3位时，默认前导为0。</p>
<p>0002 清除其它用户的写入权限，077 删除用户所属组和其它的所有权限。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/03/chapter-6-controlling-access-to-files-with-linux-file-system-permissions/" data-id="cjqlgp062000jqtkjllkqnz15" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-chapter-5-managing-local-linux-users-and-groups" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/30/chapter-5-managing-local-linux-users-and-groups/" class="article-date">
  <time datetime="2018-04-30T13:59:23.000Z" itemprop="datePublished">2018-04-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/RHEL124/">RHEL124</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/30/chapter-5-managing-local-linux-users-and-groups/">Chapter 5. Managing Local Linux Users and Groups</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>id 命令用来显示当前已登录用户的信息</p>
<p>ls -l 查看文件关联的用户。第三列显示的是用户名，第四列是组</p>
<p>ps 显示当前shell的进程</p>
<p>ps a 显示所有进程</p>
<p>ps au 显示进程关联的用户</p>
<h4 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h4><p>/etc/passwd 文件格式（七个冒号分隔字段）</p>
<p><img src="/2018/04/30/chapter-5-managing-local-linux-users-and-groups/1524823773815913.png" alt="image.png"></p>
<ol>
<li><p>username 是UID到名称的一种映射，使用用户使用</p>
</li>
<li><p>password 以前是以加密格式保存密码的位置，现在密码存储在/etc/shadow的单独文件中</p>
</li>
<li><p>UID 是用户的ID</p>
</li>
<li><p>GID 是用户的主要组ID 编号</p>
</li>
<li><p>GECOS 字段是任意文件，通常包含用户的实际姓名，现在是描述</p>
</li>
<li><p>/home/dir 是用户的家目录</p>
</li>
<li><p>shell 是用户登录时运行的程序。对于普通用户通常是提供用户命令行的shell程序。</p>
</li>
</ol>
<h4 id="组"><a href="#组" class="headerlink" title="组"></a>组</h4><p>保存在文件/etc/group 中</p>
<p>每个用户有且只有一个主要组，即passwd中的第三个字段。</p>
<p>通常用户创建的文件归主要组所有，通常用户主要组名和用户名相同，用户可以有0个或多个补充组</p>
<h4 id="su-切换命令"><a href="#su-切换命令" class="headerlink" title="su 切换命令"></a>su 切换命令</h4><p>su - &lt;username></p>
<p>su username 启动non-login shell    #su 使用当前用户环境变量，不使用username的环境变量</p>
<p>su - username 启动login shell # - 会将用户的环境变量调用，和这个用户正常登陆一样</p>
<p>sudo 以root身份执行命令</p>
<p>sudo 命令可以使用用户根据/etc/sudoers文件中的设置，而被允许以root身份或其他用户身份运行命令，su 要求的是被切换用户的密码，而sudo 是输入自己的密码  </p>
<p>sudo usermod -L username</p>
<p>使用sudo执行的所用命令都会被记录到/var/log/secure 中，在RHEL7中wheel组的成员都可以使用sudo ，早期版本wheel组用户默认没有这个权限（取消wheel组运行命令前的注释就可以了）</p>
<h5 id="visudo-编辑-etc-sudoers文件更方便"><a href="#visudo-编辑-etc-sudoers文件更方便" class="headerlink" title="visudo 编辑/etc/sudoers文件更方便"></a>visudo 编辑/etc/sudoers文件更方便</h5><p>大多数使用GUI的应用使用policykit提示用户进行身份认证，以及管理root访问权限</p>
<hr>
<h3 id="管理本地用户账户"><a href="#管理本地用户账户" class="headerlink" title="管理本地用户账户"></a>管理本地用户账户</h3><h5 id="useradd-创建用户"><a href="#useradd-创建用户" class="headerlink" title="useradd 创建用户"></a>useradd 创建用户</h5><ul>
<li><p>不带选项运行时，useradd username 会为/etc/passwd中的所用字段设置合理的默认值，默认情况下useradd 不设置任何有效密码，用户也必须设置密码后才可以登陆</p>
</li>
<li><p>useradd –help 将显示可用于覆盖默认值的基本选项。在大多数情况，可以将相同的选项用于usermod命令</p>
</li>
<li><p>默认值从/etc/login.defs文件中读取，如有效的UID编号的范围和默认密码过期规则。此文件中的值仅在创建用户是使用，更改文件对现有用户无任何影响    </p>
</li>
</ul>
<h5 id="usermod-修改现有用户"><a href="#usermod-修改现有用户" class="headerlink" title="usermod    修改现有用户"></a>usermod    修改现有用户</h5><p>usermod –help 将显示可用于修改账户的基本选项，常见选项如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">usermod 常见选项</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">-c, –coment COMMENT</td>
<td>向GECOS字段添加值，如全名</td>
</tr>
<tr>
<td style="text-align:left">-g, –gid GROUP</td>
<td>为用户账户指定主要组</td>
</tr>
<tr>
<td style="text-align:left">-G, –group GROUPS</td>
<td>为用户账户指定个组补充组</td>
</tr>
<tr>
<td style="text-align:left">-a, –append</td>
<td>与-G选项搭配使用，将用户附加到所给的补充组，而不将该用户从其他组删除</td>
</tr>
<tr>
<td style="text-align:left">-d, –home HOME_DIR</td>
<td>为用户账户指定新的主（家）目录</td>
</tr>
<tr>
<td style="text-align:left">-m, –move-home</td>
<td>将用户主目录移到新的位置，必须与-d选项搭配使用</td>
</tr>
<tr>
<td style="text-align:left">-s,–shell SHELL</td>
<td>为用户账户指定新的登陆SHELL</td>
</tr>
<tr>
<td style="text-align:left">-L, –lock</td>
<td>锁定用户账户</td>
</tr>
<tr>
<td style="text-align:left">-U, –unlock</td>
<td>解锁用户账户</td>
</tr>
</tbody>
</table>
<h5 id="userdel-删除用户"><a href="#userdel-删除用户" class="headerlink" title="userdel    删除用户"></a>userdel    删除用户</h5><p>userdel username 可将用户从/etc/passwd中删除，但默认情况下保留主目录不变。</p>
<p>老用户删除后新用户将使用老用户的UID，原文件将在下次创建同等UID的用户是被授权给新用户。</p>
<p>userdel -r username 同时删除用户和和其主目录。</p>
<p>find / -nouser -o -nogroup 2&gt;/dev/null #查找没有用户或者没有组的文件或目录</p>
<p>id 显示用户信息  </p>
<p>id username 将显示username的用户信息，包括用户的UID编号和组成员资格</p>
<p>passwd 设置密码  </p>
<p>passwd username  #如果不使用username 将代表当前用户，root可以在不需要旧密码的情况下修改其他用户密码。</p>
<p>root 可以将密码设置成任何值，如果密码不符合要求，系统会有提示，但仍可以设置。</p>
<p>普通用户必须选择长度至少为8个字符，并且不以字典词语、用户名为密码基础</p>
<p>UID 范围</p>
<p>特定的UID编号和编号范围供RHEL用于特殊目的。</p>
<p>UID 0 始终分配给超级用户root</p>
<p>UID 1-200 是一系列“系统用户”，静态分配给红帽系统进程</p>
<p>UID 201-999 是一系列“系统用户”，供文件系统中没有自己的文件的系统进程使用，通常在安装需要他们的软件时，从可用池中动态分配它们。程序以这些“无特权”系统用户身份运行，以便限制它们访问正常运行所需的资源。</p>
<p>UID 1000+ 是可供分配给普通用户的范围。</p>
<p>RHEL7 以前的版本是UID 1-499 为系统用户，500+ 为普通用户。默认范围可以在/etc/login.defs中修改</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useradd juliet    <span class="comment">#添加新用户</span></span><br><span class="line">tail -2 /etc/passwd     <span class="comment">#查看最后两个用户</span></span><br><span class="line">passwd juliet    <span class="comment">#修改juliet的密码</span></span><br></pre></td></tr></table></figure>
<h4 id="管理本地组账户"><a href="#管理本地组账户" class="headerlink" title="管理本地组账户"></a>管理本地组账户</h4><h5 id="groupadd-创建组"><a href="#groupadd-创建组" class="headerlink" title="groupadd 创建组"></a>groupadd 创建组</h5><p>groupadd groupname 如果不带选项，则使用/etc/login.defs文件的指定范围内的下一个可用GID</p>
<p>-g GID 选项用来指定具体的DIG<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupadd -g 500 ateam     <span class="comment">#创建组</span></span><br></pre></td></tr></table></figure></p>
<p>用户专用组（GID 1000以上）是系统自动创建的，因此通常预备一系列GID编号待用于补充组，较高的范围可以避免与系统中GID（0-999）冲突  </p>
<p>-r 选项将使用/etc/login.defs中系统用户的GID编号分配<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupadd -r appusers</span><br></pre></td></tr></table></figure></p>
<p>groupmod 修改现有的组  </p>
<p>-n 选项用于指定新的名称<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupmod -n javaapp appusers    <span class="comment">#修改javaapp组为appusers</span></span><br></pre></td></tr></table></figure></p>
<p>-g 选项用于指定新的GID<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupmod -g 6000 ateam    <span class="comment">#修改ateam组的GID为6000</span></span><br></pre></td></tr></table></figure></p>
<p>groupdel 删除组<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupdel javaapp</span><br></pre></td></tr></table></figure></p>
<p>如果该组是当前某一用户的主要组，则他不能被删除，与userdel 一样检查文件系统，确保不会遗留该组拥有的任何文件</p>
<p>usermod 变更组成员资格<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">usermod -g groupname  username   <span class="comment">#更改用户主要组</span></span><br><span class="line">usermod -aG wheel elvis     <span class="comment">#将用户elvis添加进wheel补充组，如果不使用-a选项，用户将删除其他补充组</span></span><br></pre></td></tr></table></figure></p>
<h5 id="管理用户密码"><a href="#管理用户密码" class="headerlink" title="管理用户密码"></a>管理用户密码</h5><p>$6$4Sme7FVt$kIMTvWnXbLGVgpVz2xHuWWAY6AxLEG4rtUm/2NvXyocJe0uT/7rIxD.52GvFJR/txTihH8VatnZ.R65YnmZzL0</p>
<p>#以$符为分隔，共三段</p>
<ul>
<li><ol>
<li>哈希算法，数字1表示MD5哈希，数字6为SHA-512哈希算法</li>
</ol>
</li>
<li><ol start="2">
<li>“4Sme7FVt” 用于加密哈希的salt，这原先是随机选取的，salt和未加密的密码组合并加密。创建加密的哈希值，使用salt可以防止两个或多个相同密码的用户出现相同的条目</li>
</ol>
</li>
<li><ol start="3">
<li>“kIMTvWnXbLGVgpVz2xHuWWAY6AxLEG4rtUm/2NvXyocJe0uT/7rIxD.52GvFJR/txTihH8VatnZ.R65YnmZzL0” 以加密的哈希值</li>
</ol>
</li>
</ul>
<p>RHEL7 支持新密码哈希算法：SHA-256(算法5)，SHA-512（算法6）,root 用户通过使用authconfig –passslgo 命令，并从md5,sha-256和sha-512中选择一个适当的参数，7默认使用sha-512<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[change@rhel ~]$ sudo authconfig --<span class="built_in">help</span> | grep passalgo</span><br><span class="line">  --passalgo=&lt;descrypt|bigcrypt|md5|sha256|sha512&gt;</span><br></pre></td></tr></table></figure></p>
<p>/etc/shadow 格式（九个冒号分隔的字段）</p>
<p><img src="/2018/04/30/chapter-5-managing-local-linux-users-and-groups/1525166687554964.png" alt="blob.png"></p>
<p>登陆名称。这必须是系统中的有效账户名</p>
<p>以加密的密码。密码开通为！时表示该密码已被锁定。</p>
<p>最近一次更改密码的日期，以距离1970年1月1日的天数表示</p>
<p>可以更改密码前的最少天数，如果0表示“无最短期限要求”</p>
<p>必须修改密码前的最多天数。</p>
<p>密码即将到期的警告期，以天数表示。0表示不警告。</p>
<p>账户在密码过期后保持活动的天数，在此期限内，用户依然可以登录系统并修改密码。在指定天数过后，账户被锁定，变为不活动。</p>
<p>账户到期日期，以距离1970年1月1日的天数表示</p>
<p>这一blank 字段为预留字段，供未来使用</p>
<p><img src="/2018/04/30/chapter-5-managing-local-linux-users-and-groups/1525167668913001.png" alt="blob.png"><br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">chage -d 0 username    <span class="comment">#强制用户在下次登录是修改密码</span></span><br><span class="line">chage -l user    <span class="comment">#列出当前用户的设置</span></span><br><span class="line">chage -E YYYY-MM-DD    <span class="comment">#将在指定日期是账户到期</span></span><br><span class="line">date -d <span class="string">"+45 days"</span>    <span class="comment">#计算未来的日期</span></span><br><span class="line">usermod -L romeo     <span class="comment">#锁定用户romeo</span></span><br><span class="line">usermod -U romeo     <span class="comment">#解除锁定</span></span><br><span class="line">chage -M 90 romeo    <span class="comment">#设置用户romeo 每90天创建新密码</span></span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/30/chapter-5-managing-local-linux-users-and-groups/" data-id="cjqlgp08e001jqtkj96wtr12f" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-chapter-4-creatingviewingand-editing-text-files" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/27/chapter-4-creatingviewingand-editing-text-files/" class="article-date">
  <time datetime="2018-04-27T08:49:36.000Z" itemprop="datePublished">2018-04-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/RHEL124/">RHEL124</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/27/chapter-4-creatingviewingand-editing-text-files/">Chapter 4 Creating,Viewing,And Editing Text Files</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <table>
<thead>
<tr>
<th style="text-align:left">编号</th>
<th>通道名称</th>
<th>描述</th>
<th>默认连接</th>
<th>用法  </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td>stdin</td>
<td>标准输入</td>
<td>键盘</td>
<td>仅读取  </td>
</tr>
<tr>
<td style="text-align:left">1</td>
<td>stdout</td>
<td>标准输出</td>
<td>终端</td>
<td>仅写入  </td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td>stderr</td>
<td>标准错误</td>
<td>终端</td>
<td>仅写入  </td>
</tr>
<tr>
<td style="text-align:left">3+</td>
<td>filename</td>
<td>其它文件</td>
<td>无</td>
<td>读取/写入  </td>
</tr>
</tbody>
</table>
<p>重定向输出到文件</p>
<table>
<thead>
<tr>
<th style="text-align:left">用法</th>
<th>说明</th>
<th>视觉效果  </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">&gt;file</td>
<td>重定向stdout到文件（1）</td>
<td><img src="/2018/04/27/chapter-4-creatingviewingand-editing-text-files/1524818205308304.png" alt="图片.png"></td>
</tr>
<tr>
<td style="text-align:left">&gt;&gt;file</td>
<td>重定向stdout到文件，附加到当前文件内容后面（2）</td>
<td><img src="/2018/04/27/chapter-4-creatingviewingand-editing-text-files/1524818219547743.png" alt="图片.png"></td>
</tr>
<tr>
<td style="text-align:left">2&gt;file</td>
<td>重定向stderr到文件（1）</td>
<td><img src="/2018/04/27/chapter-4-creatingviewingand-editing-text-files/1524818191991552.png" alt="图片.png"></td>
</tr>
<tr>
<td style="text-align:left">2&gt;/dev/null</td>
<td>将stderr错误信息重定向到/dev/null从而将它丢弃</td>
<td><img src="/2018/04/27/chapter-4-creatingviewingand-editing-text-files/1524818180473442.png" alt="图片.png"></td>
</tr>
<tr>
<td style="text-align:left">&amp;&gt;file</td>
<td>将stdout和stderr合并到一个文件（1）</td>
<td><img src="/2018/04/27/chapter-4-creatingviewingand-editing-text-files/1524818174855912.png" alt="图片.png"></td>
</tr>
<tr>
<td style="text-align:left">&gt;&gt;file 2&gt;&amp;1</td>
<td>合并stdout和stderr，并且附加到当前文件内容后面（2）（3）</td>
<td><img src="/2018/04/27/chapter-4-creatingviewingand-editing-text-files/1524818166553035.png" alt="图片.png"></td>
</tr>
<tr>
<td style="text-align:left">注</td>
<td>（1）覆盖现在文件，如果为新文件则创建文件<br>（2）附加到现有文件，如果为新文件则创建文件<br>（3）重定向顺向很重要，可避免出现意外的命令行为。2&gt;&amp;1 将stderr发送到与stdout相同的位置。要使其生效，在向stdout中添加stderr之前，需要首先重定向stdout.尽管&amp;&gt;&gt;是向文件中附加stdout和stderr的备选方法，但2&gt;&amp;1 是通过管道同时发送stdout和stderr所需要的方法。</td>
</tr>
</tbody>
</table>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">date &gt; /tmp/saved-timestamp    <span class="comment">#保存时间到文件</span></span><br><span class="line"></span><br><span class="line">tail -n 100 /var/<span class="built_in">log</span>/dmesg &gt; /tm/last-100-boot-messages    <span class="comment">#复制文件日志的最后100行到另一个文件</span></span><br><span class="line"></span><br><span class="line">cat file1 file2 file3 file4 &gt; /tmp/all-four-in-one    <span class="comment">#将四个文件连接成一个</span></span><br><span class="line"></span><br><span class="line">ls -a &gt; /tmp/my-file-names    <span class="comment">#将当前目录的隐藏文件名和常规文件名列出到文件中</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"new line of information"</span> &gt;&gt;/tmp/many-lines-of-information    <span class="comment">#将输出附加到现有文件</span></span><br><span class="line"></span><br><span class="line">diff previous-file current-file &gt;&gt; /tmp/tracking-changes-made    <span class="comment">#将比较内容输出附加到现有文件</span></span><br><span class="line"></span><br><span class="line">find /etc -name passwd 2&gt; /tmp/errors    <span class="comment">#将错误重定向到文件</span></span><br><span class="line"></span><br><span class="line">find /etc -name passwd &gt;/tmp/output 2&gt; /tmperrors    <span class="comment">#将进程输出和错误消息分别保存到单独文件</span></span><br><span class="line"></span><br><span class="line">find /etc -name passwd &gt;/tmp/output 2&gt;/dev/null    <span class="comment">#忽略并丢弃错误消息</span></span><br><span class="line"></span><br><span class="line">find /etc -name passwd &amp;&gt; /tmp/save-both    <span class="comment">#将输出和错误消息存储在一起</span></span><br><span class="line"></span><br><span class="line">find /etc -name passwd  &gt;&gt; /tmp/save-toth 2&gt;&amp;1    <span class="comment">#将输出和生成的错误消息附加到现有文件</span></span><br></pre></td></tr></table></figure>
<h4 id="构建管道-“-”"><a href="#构建管道-“-”" class="headerlink" title="构建管道 “|”"></a>构建管道 “|”</h4><p>从一个进程标准输出到另一个进程的标准输入</p>
<p><img src="/2018/04/27/chapter-4-creatingviewingand-editing-text-files/1524823380758403.png" alt="image.png"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ls -l /usr/bin | less</span><br><span class="line">ls | wc -l &gt; /tmp/how-many-files    <span class="comment">#计算输出列出中的行数并重定向到文件</span></span><br><span class="line">ls -t | head -n 10 &gt; /tmp/ten-last-changed-files    <span class="comment">#抓取列表的前几行、或后几行，或选定的行并重定向到文件</span></span><br></pre></td></tr></table></figure>
<p><img src="/2018/04/27/chapter-4-creatingviewingand-editing-text-files/1524823368317604.png" alt="image.png"></p>
<p>使用 tee 命令传送，tee 命令显示或重定向通常因传送而被隐藏的中间结果。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ls -l | tee /tmp/saved-output    <span class="comment">#在终端上查看 ls 列表同时将该列表存储到文件中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#确定当前窗口的终端设备。将结果作为邮件发送，并在此窗口中查看相同的结果。</span></span><br><span class="line">tty</span><br><span class="line">ls -l | tee /dev/pts/0 | mail -s subject student@desktop1.example.com</span><br></pre></td></tr></table></figure></p>
<hr>
<p>vi &amp;&amp; vim</p>
<p><img src="/2018/04/27/chapter-4-creatingviewingand-editing-text-files/1524823338808284.png" alt="image.png"></p>
<p>vim 的四个模式：编辑模式，命令模式，可视模式，扩展命令模式。默认启动进行命令模式，可用于导航、剪切和粘贴，以及其他文件操作，通过单字符进行各个模式：</p>
<p>“i” 进入插入模式，编辑模式，按Esc 退出到命令模式</p>
<p>“v” 进入可视模式，在其中可以选择多个字符进行操作，使用”V”键选择多选，使用Ctrl+v 可选择文本块。v,V,Ctrl+v 同样可用于退出可视模式</p>
<p>“:” 冒号,启动扩展命令模式,可以执行写入、退出、保存等</p>
<p>命令模式：u键撤销上次的编辑操作，x键删除光标所在的字符，:w 保存 :wq 保存退出  :q! 强制退出放弃修改。</p>
<p>可视模式：y ：复制，p：粘贴 ，上下左右选择字符。</p>
<p>安装vim-enhanced软件包提供vimtutor针对每一个操作的练习。可以安装学习一下</p>
<p>图形编辑器gedit 、nano</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/27/chapter-4-creatingviewingand-editing-text-files/" data-id="cjqlgp05y000fqtkjgjd6hzby" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-chapter-3-getting-help-in-red-hat-enterprise-linux" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/26/chapter-3-getting-help-in-red-hat-enterprise-linux/" class="article-date">
  <time datetime="2018-04-26T03:01:18.000Z" itemprop="datePublished">2018-04-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/RHEL124/">RHEL124</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/26/chapter-3-getting-help-in-red-hat-enterprise-linux/">Chapter 3. Getting Help in Red Hat Enterprise Linux</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <table>
<thead>
<tr>
<th style="text-align:left">章节</th>
<th style="text-align:left">内容类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">用户命令（可执行命令和shell程序）</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">系统调用（从用户空间调用的内核例程）</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td style="text-align:left">库函数（由程序提供）</td>
</tr>
<tr>
<td style="text-align:left">4</td>
<td style="text-align:left">特殊文件（如设备文件）</td>
</tr>
<tr>
<td style="text-align:left">5</td>
<td style="text-align:left">文件格式（用于许多配置文件和结构）</td>
</tr>
<tr>
<td style="text-align:left">6</td>
<td style="text-align:left">游戏（过去的有趣程序章节）</td>
</tr>
<tr>
<td style="text-align:left">7</td>
<td style="text-align:left">惯例，标准和其它（协议、文件系统）</td>
</tr>
<tr>
<td style="text-align:left">8</td>
<td style="text-align:left">系统管理和特权命令（维护任务）</td>
</tr>
<tr>
<td style="text-align:left">9</td>
<td style="text-align:left">Linux 内核API（内核调用）</td>
</tr>
</tbody>
</table>
<h4 id="导航-man-page"><a href="#导航-man-page" class="headerlink" title="导航 man page"></a>导航 man page</h4><table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">结果</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">空格键</td>
<td style="text-align:left">向前（向下）滚动一个屏幕</td>
</tr>
<tr>
<td style="text-align:left">PageDown</td>
<td style="text-align:left">向前（向下）滚动一个屏幕</td>
</tr>
<tr>
<td style="text-align:left">PageUp</td>
<td style="text-align:left">向后（向上）滚动一个屏幕</td>
</tr>
<tr>
<td style="text-align:left">向下箭头</td>
<td style="text-align:left">向前（向下）滚动一行</td>
</tr>
<tr>
<td style="text-align:left">向上箭头</td>
<td style="text-align:left">向后（向上）滚动一行</td>
</tr>
<tr>
<td style="text-align:left">d</td>
<td style="text-align:left">向前（向下）滚动半个屏幕</td>
</tr>
<tr>
<td style="text-align:left">u</td>
<td style="text-align:left">身后（向上）滚动半个屏幕</td>
</tr>
<tr>
<td style="text-align:left">/String</td>
<td style="text-align:left">在man page 中向前（向下）搜索string</td>
</tr>
<tr>
<td style="text-align:left">n</td>
<td style="text-align:left">在man page 中重复之前的向前（向下）搜索</td>
</tr>
<tr>
<td style="text-align:left">N</td>
<td style="text-align:left">在man page中重复之前的向后（向上）搜索</td>
</tr>
<tr>
<td style="text-align:left">g</td>
<td style="text-align:left">转到man page的开头</td>
</tr>
<tr>
<td style="text-align:left">G</td>
<td style="text-align:left">转到man page的末尾</td>
</tr>
<tr>
<td style="text-align:left">q</td>
<td style="text-align:left">退出 man ,并返回到shell命令提示符</td>
</tr>
</tbody>
</table>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">man passwd <span class="comment">#默认显示章节1,passwd(1)</span></span><br><span class="line">man 5 passwd <span class="comment">#查看passwd 第5章节passwd(5)</span></span><br></pre></td></tr></table></figure>
<p>搜索string时允许正则表达试<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">man -k keyword  <span class="comment">#执行标题和描述  </span></span><br><span class="line">man -K keyward <span class="comment">#执行全文页面搜索</span></span><br></pre></td></tr></table></figure></p>
<p>#根据关键字搜索man page ,关键字搜索依赖mandb(8)生成的索引；必须以root身份运行，该命令每天通过cron.daily 运行。或者anacrontab 在启动一小时内运行（如果过期）</p>
<h4 id="pinfo"><a href="#pinfo" class="headerlink" title="pinfo"></a>pinfo</h4><p>man page 的正式格式作用于命令参考时很有用，但作用于普通文档却用处不大。对于此类文档，GNU项目发了一种不同的在线文档系统，称为GNU info。</p>
<p>info 文档结构超链接式的info 节点组成。此格式比man page 更灵活，允许对复杂命令和概念进行彻底的说明。</p>
<p>pinfo info 读取器比原始的info命令更加高级。它设计为与lynx文本web 浏览器击键操作相符，也添加了颜色。可以通过pinfo topic 浏览特定的主题的节点。</p>
<p>pinfo nano #查看nano  </p>
<p>pinfo 和 man page 按键对比</p>
<table>
<thead>
<tr>
<th style="text-align:left">导航</th>
<th style="text-align:left">pinfo</th>
<th>man page  </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">向前（向下）滚动一个屏幕</td>
<td style="text-align:left">PageDown 或空格键</td>
<td>PageDown或空格键  </td>
</tr>
<tr>
<td style="text-align:left">向后（向上）滚动一个屏幕</td>
<td style="text-align:left">PageUp 或 b</td>
<td>PageUp 或b  </td>
</tr>
<tr>
<td style="text-align:left">显示主题目录</td>
<td style="text-align:left">d</td>
<td>-  </td>
</tr>
<tr>
<td style="text-align:left">向前（向下）滚动半个屏幕</td>
<td style="text-align:left">-</td>
<td>d  </td>
</tr>
<tr>
<td style="text-align:left">显示主题的顶部（上部）</td>
<td style="text-align:left">主页</td>
<td>1G  </td>
</tr>
<tr>
<td style="text-align:left">向后（向上）滚动半个屏幕</td>
<td style="text-align:left">-</td>
<td>u  </td>
</tr>
<tr>
<td style="text-align:left">向前（向下）滚动到下一超链接</td>
<td style="text-align:left">向下箭头</td>
<td>-  </td>
</tr>
<tr>
<td style="text-align:left">打开光标处的主题</td>
<td style="text-align:left">Enter</td>
<td>-  </td>
</tr>
<tr>
<td style="text-align:left">向前（向下）滚动一行</td>
<td style="text-align:left">-</td>
<td>向下箭头键或Enter  </td>
</tr>
<tr>
<td style="text-align:left">向后（向上）滚动到上一超链接</td>
<td style="text-align:left">向上箭头</td>
<td>-  </td>
</tr>
<tr>
<td style="text-align:left">向后（向上）滚动一行</td>
<td style="text-align:left">-</td>
<td>向上箭头  </td>
</tr>
<tr>
<td style="text-align:left">搜索某种模式</td>
<td style="text-align:left">/string</td>
<td>/string  </td>
</tr>
<tr>
<td style="text-align:left">显示主题中的下一个节点（章节）</td>
<td style="text-align:left">n</td>
<td>-  </td>
</tr>
<tr>
<td style="text-align:left">重复之前的向前（向下）搜索</td>
<td style="text-align:left">/，再按Enter</td>
<td>n  </td>
</tr>
<tr>
<td style="text-align:left">显示主题中的上一节点（章节）</td>
<td style="text-align:left">p</td>
<td>-  </td>
</tr>
<tr>
<td style="text-align:left">重复之前的向后（向上）搜索</td>
<td style="text-align:left">-</td>
<td>N  </td>
</tr>
<tr>
<td style="text-align:left">退出程序</td>
<td style="text-align:left">q</td>
<td>q  </td>
</tr>
</tbody>
</table>
<h4 id="读取-usr-share-doc-中的文档"><a href="#读取-usr-share-doc-中的文档" class="headerlink" title="读取/usr/share/doc 中的文档"></a>读取/usr/share/doc 中的文档</h4><p>安装软件包时，识别为文档的文件将移到/usr/share/doc/packagename 目录中，一些软件包附带大量的示例、配置文件模板、脚本、教程或用户手册。</p>
<p>firefox <a href="http://file:///usr/share/doc" target="_blank" rel="noopener">file:///usr/share/doc</a>  </p>
<p>yum list <em>-doc</em>  #查看所有文档做为一个单独提供的软件  </p>
<h4 id="红帽官方的帮助"><a href="#红帽官方的帮助" class="headerlink" title="红帽官方的帮助"></a>红帽官方的帮助</h4><p>man man #查看man的使用方法<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">man -t passwd &gt; passwd.ps    <span class="comment">#为passwd man page 创建格式化输出文件</span></span><br><span class="line"></span><br><span class="line">file passwd.ps    <span class="comment">#查看文件类型</span></span><br><span class="line"></span><br><span class="line">less   passwd.ps <span class="comment">#查看文件内容</span></span><br><span class="line"></span><br><span class="line">man -k postscript viewer     <span class="comment">#了解用于查看或打印postscript文件命令，-k 指定关键字</span></span><br><span class="line"></span><br><span class="line">man lp    <span class="comment">#查看lp命令的用法  </span></span><br><span class="line"></span><br><span class="line">lp passwd.ps -P 2-3     <span class="comment">#打印passwd.ps的2-3页</span></span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/26/chapter-3-getting-help-in-red-hat-enterprise-linux/" data-id="cjqlgp05w000dqtkjk8i9pbra" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/RHEL124/">RHEL124</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/RHEL134/">RHEL134</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/未分类/">未分类</a><span class="category-list-count">2</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/pxe/">pxe</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/samba/">samba</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/pxe/" style="font-size: 10px;">pxe</a> <a href="/tags/samba/" style="font-size: 10px;">samba</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">16</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/10/18/rh134-e7-ac-ac-e5-8d-81-e4-ba-94-e7-ab-a0-e7-b3-bb-e7-bb-9f-e7-ae-a1-e7-90-86-e4-ba-8c-e6-80-bb-e5-a4-8d-e4-b9-a0/">RH134 第十五章 系统管理二总复习</a>
          </li>
        
          <li>
            <a href="/2018/10/17/rh134-e7-ac-ac-e5-8d-81-e5-9b-9b-e7-ab-a0-e4-bd-bf-e7-94-a8-firewalld-e9-99-90-e5-88-b6-e7-bd-91-e7-bb-9c-e9-80-9a-e4-bf-a1/">RH134 第十四章 使用 FIREWALLD 限制网络通信</a>
          </li>
        
          <li>
            <a href="/2018/10/16/rh134-e7-ac-ac-e5-8d-81-e4-b8-89-e7-ab-a0-e5-af-b9-red-hat-enterprise-linux-e5-90-af-e5-8a-a8-e8-bf-87-e7-a8-8b-e8-bf-9b-e7-a8-8b-e6-8e-a7-e5-88-b6-e6-95-85-e9-9a-9c-e6-8e-92-e9-99-a4/">RH134 第十三章 对 RED HAT ENTERPRISE LINUX 启动过程进程控制故障排除</a>
          </li>
        
          <li>
            <a href="/2018/10/12/autofs-e8-87-aa-e5-8a-a8-e6-8c-82-e8-bd-bd/">autofs 自动挂载</a>
          </li>
        
          <li>
            <a href="/2018/10/11/rh134-e7-ac-ac-e5-8d-81-e4-ba-8c-e7-ab-a0-e8-ae-bf-e9-97-ae-e5-85-b7-e6-9c-89smb-e7-9a-84-e7-bd-91-e7-bb-9c-e5-ad-98-e5-82-a8/">RH134 第十二章 访问具有SMB的网络存储</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 change<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>