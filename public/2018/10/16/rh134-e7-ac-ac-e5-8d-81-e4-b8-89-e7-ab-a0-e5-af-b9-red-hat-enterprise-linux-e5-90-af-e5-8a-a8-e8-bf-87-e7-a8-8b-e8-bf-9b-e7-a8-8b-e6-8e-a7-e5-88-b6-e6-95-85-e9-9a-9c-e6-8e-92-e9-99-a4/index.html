<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>RH134 第十三章 对 RED HAT ENTERPRISE LINUX 启动过程进程控制故障排除 | rhel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="REHL 7 启动过程1、计算机已接通电源 2、系统固件搜索可启动设备 3、系统固件从磁盘读取启动加载器，然后将系统控制权交给启动加载器。在 RHEL 7 中这通常是 grub2。  通过以下方式进行配置 ：grub2-install  4、启动加载器从磁盘加载其配置，然后向用户显示用于启动的可能配置的菜单。    通过以下方式进行配置：/etc/grub.d/ 、/etc/default/gru">
<meta property="og:type" content="article">
<meta property="og:title" content="RH134 第十三章 对 RED HAT ENTERPRISE LINUX 启动过程进程控制故障排除">
<meta property="og:url" content="http://yoursite.com/2018/10/16/rh134-e7-ac-ac-e5-8d-81-e4-b8-89-e7-ab-a0-e5-af-b9-red-hat-enterprise-linux-e5-90-af-e5-8a-a8-e8-bf-87-e7-a8-8b-e8-bf-9b-e7-a8-8b-e6-8e-a7-e5-88-b6-e6-95-85-e9-9a-9c-e6-8e-92-e9-99-a4/index.html">
<meta property="og:site_name" content="rhel">
<meta property="og:description" content="REHL 7 启动过程1、计算机已接通电源 2、系统固件搜索可启动设备 3、系统固件从磁盘读取启动加载器，然后将系统控制权交给启动加载器。在 RHEL 7 中这通常是 grub2。  通过以下方式进行配置 ：grub2-install  4、启动加载器从磁盘加载其配置，然后向用户显示用于启动的可能配置的菜单。    通过以下方式进行配置：/etc/grub.d/ 、/etc/default/gru">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-01-06T17:13:29.985Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RH134 第十三章 对 RED HAT ENTERPRISE LINUX 启动过程进程控制故障排除">
<meta name="twitter:description" content="REHL 7 启动过程1、计算机已接通电源 2、系统固件搜索可启动设备 3、系统固件从磁盘读取启动加载器，然后将系统控制权交给启动加载器。在 RHEL 7 中这通常是 grub2。  通过以下方式进行配置 ：grub2-install  4、启动加载器从磁盘加载其配置，然后向用户显示用于启动的可能配置的菜单。    通过以下方式进行配置：/etc/grub.d/ 、/etc/default/gru">
  
    <link rel="alternate" href="/atom.xml" title="rhel" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">rhel</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">growing study</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-rh134-e7-ac-ac-e5-8d-81-e4-b8-89-e7-ab-a0-e5-af-b9-red-hat-enterprise-linux-e5-90-af-e5-8a-a8-e8-bf-87-e7-a8-8b-e8-bf-9b-e7-a8-8b-e6-8e-a7-e5-88-b6-e6-95-85-e9-9a-9c-e6-8e-92-e9-99-a4" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/16/rh134-e7-ac-ac-e5-8d-81-e4-b8-89-e7-ab-a0-e5-af-b9-red-hat-enterprise-linux-e5-90-af-e5-8a-a8-e8-bf-87-e7-a8-8b-e8-bf-9b-e7-a8-8b-e6-8e-a7-e5-88-b6-e6-95-85-e9-9a-9c-e6-8e-92-e9-99-a4/" class="article-date">
  <time datetime="2018-10-16T03:38:24.000Z" itemprop="datePublished">2018-10-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/RHEL134/">RHEL134</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      RH134 第十三章 对 RED HAT ENTERPRISE LINUX 启动过程进程控制故障排除
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h5 id="REHL-7-启动过程"><a href="#REHL-7-启动过程" class="headerlink" title="REHL 7 启动过程"></a>REHL 7 启动过程</h5><p>1、计算机已接通电源</p>
<p>2、系统固件搜索可启动设备</p>
<p>3、系统固件从磁盘读取启动加载器，然后将系统控制权交给启动加载器。在 RHEL 7 中这通常是 grub2。</p>
<p> 通过以下方式进行配置 ：grub2-install </p>
<p>4、启动加载器从磁盘加载其配置，然后向用户显示用于启动的可能配置的菜单。</p>
<p>   通过以下方式进行配置：/etc/grub.d/ 、/etc/default/grub 和 （非手动） /boot/grub2/grub.cfg  </p>
<p>5、在用户做出选择（或发生自动超时）后，启动加载器会从磁盘加载配置的内核及initramfs 并将它们置于内存中。initramfs 是经过 gzip 的cpio 归档，其中包含启动时所有必要硬件的内核模块、初始化脚本等。在 RHEL7 中，initramfs 包含自身可用的整个系统。  </p>
<p>  通过以下方式进行配置：/etc/dracut.conf  </p>
<p>6、启动加载器将系统控制权交给内核，从而传递启动加载器的内核命令行中指定的任何选项，以及initramfs 在内存中的位置。</p>
<p>   通过以下方式进行配置：/etc/grub.d/、/etc/default/grub 和 (非手动) /boot/grub2/grub.cfg  </p>
<p>7、对于内核可在 initamfs 中找到驱动程序的所有硬件，内核会初始化这些硬件，然后作为 PID 1 从 initramfs 执行 /sbin/init 。在 RHEL 7 中initramfs 包含systemd 的工作副本作为 /sbin/init ，并包含 udev 守护进程</p>
<p>  通过以下方式进行配置 init = 命令行参数  </p>
<p>8、initramfs 中的 systemd 实例会执行 initrd.target 目标的所有单元。这包括在 /sysroot 上挂载实际的 root 文件系统 。</p>
<p>   通过以下方式进行配置： /etc/fstab   </p>
<p>9、内核 root 文件系统从initramfs root 文件系统切换（回转）为之前挂载于 /sysroot 上的系统 root 文件系统。随后 ，systemd 会使用系统中安装 systemd 副本来自动重新执行。</p>
<p>10、systemd 会查找从内核命令传递或系统中配置的默认目标，然后启动（或停止）单元，以符合目标的配置，从而自动解决单元间的依赖关系。本质上，systemd 目标是一组应在激活后达到所需系统状态的单元。这些目标通常至少包含一个生成基于文本的登录或图形登录屏幕。</p>
<p>   通过以下方式进行配置： /etc/systemd/system/default.target 、/etc/systemd/system/  </p>
<h5 id="启动、重新启动和关闭"><a href="#启动、重新启动和关闭" class="headerlink" title="启动、重新启动和关闭"></a>启动、重新启动和关闭</h5><hr>
<p>要关闭或从命令行重新启动正在运行的系统，管理员可以使用systemcl 命令</p>
<p>systemctl poweroff 会停止所有运行的服务，卸载所有文件系统（或者在文件系统无法卸载时以只读形式将其重新挂载），然后关闭系统。</p>
<p>systemctl reboot 会停止所有运行的服务，卸载所有文件系统，然后重新启动系统。</p>
<p>为了方便身后兼容，poweroff 和 reboot 命令仍然存在，但是在RHEL 7 中，它们是指向 systemctl 工具的的符号链接。</p>
<h3 id="tips"><a href="#tips" class="headerlink" title="tips:"></a>tips:</h3><p>systemctl halt 和 halt 也用于停止系统，但与其poweroff 不同，这些命令不会关闭系统而是让系统进入能安全地手动关闭的状态。  </p>
<h3 id="选择systemd-目标"><a href="#选择systemd-目标" class="headerlink" title="选择systemd 目标"></a>选择systemd 目标</h3><p>systemd 目标是一组应在启动后到达所需状态的systemd 单元。下表列出了这些目标的最重要的信息。</p>
<table>
<thead>
<tr>
<th style="text-align:left">目标</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">graphical.target</td>
<td>多用户、图形+文本</td>
</tr>
<tr>
<td style="text-align:left">multi-user.target</td>
<td>多用户、文本登录</td>
</tr>
<tr>
<td style="text-align:left">rescue.target</td>
<td>sulogin 提示，表示基本系统初始化已完成</td>
</tr>
<tr>
<td style="text-align:left">emergency.target</td>
<td>sulogin 提示，表示 initramfs 回转完成，且系统 root 以只读形式挂载于 / 上</td>
</tr>
</tbody>
</table>
<p>某个目标可能属于另一目标：例如 graphical.target 包含 multi-user.target 。后者反过来取决于 basic.target 和其他目标，使用以下命令可从命令行查看这些依赖关系；<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl list-dependencies graphical.target | grep target    <span class="comment">#查看依赖关系</span></span><br><span class="line">systemctl list-units --<span class="built_in">type</span>=target --all <span class="comment">#查看所有可用目标的描述</span></span><br><span class="line">systemctl list-units-files --<span class="built_in">type</span>=target --all <span class="comment">#查看磁盘上安装的所有目标的概述</span></span><br><span class="line">systemctl isolate multi-user.target    <span class="comment">#在运行的系统中，切换到其他目标，类似于老版本 init 5</span></span><br></pre></td></tr></table></figure></p>
<p>隔离某个目标会停止该目标（及其依赖项）不需要的所有服务，并启动任何尚未启动的所需服务。</p>
<h5 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h5><p>并非所有目标都能隔离。只有单元文件中设置了 AllowIsolate=yes 的目标才可以隔离；例如 graphical.target 目标可以隔离，但 cryptsetup.target 目标不能隔离。AllowIsolate 设置在target 文件中配置</p>
<h6 id="设置默认目标"><a href="#设置默认目标" class="headerlink" title="设置默认目标"></a>设置默认目标</h6><p>在系统启动且将控制权从 initramfs 交给systemd 后，systemd 会尝试激活 default.target 目标。通常，default.target 目标是 (/etc/systemd/system中) 指向 graphical.target 或 multi-user.target 的符号链接。</p>
<p>systemctl 工具随附两个命令（get-default 和 set-default ） 用于管理该符号链接，而不是手动编辑该连接。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@client ~]<span class="comment"># systemctl get-default</span></span><br><span class="line">multi-user.target</span><br><span class="line">[root@client ~]<span class="comment"># systemctl set-default graphical.target</span></span><br><span class="line">Removed symlink /etc/systemd/system/default.target.</span><br><span class="line">Created symlink from /etc/systemd/system/default.target to /usr/lib/systemd/system/graphical.target.</span><br></pre></td></tr></table></figure></p>
<h6 id="在启动时选择其他目标"><a href="#在启动时选择其他目标" class="headerlink" title="在启动时选择其他目标"></a>在启动时选择其他目标</h6><p>要在启动时选择其它目标，可从启动加载器将特殊选项附加到内核命令行：systemd.init= .</p>
<p>例如，要使系统启动进入救援 shell  （在这种情况下，系统可在（几乎）没有任何服务运行的情况下进行配置更改），则在启动前，可从交互式启动加载器菜单中附加以下内容：</p>
<p>systemd.unit=rescue.target</p>
<p>该配置更改仅影响单个启动，这使其成为排除启动过程故障的有用工具。</p>
<p>要使用这种选择其他目标的方法，请针对 RHEL 7 系统执行以下步骤：</p>
<p>1、（重新）启动系统 </p>
<p>2、按任意键中断启动加载菜单倒计时。</p>
<p>3、将光标移动至要启动的条目</p>
<p>4、按e 编辑当前条目</p>
<p>5、将光标移动至以 linux16 开关行。此为内核命令行</p>
<p>6、附加 systemd.unit=desired.target </p>
<p>7、按 Ctrl +x 使用这些更改进行启动.</p>
<p>修复常见启动问题  </p>
<hr>
<h3 id="恢复root-密码"><a href="#恢复root-密码" class="headerlink" title="恢复root 密码"></a>恢复root 密码</h3><p>每个系统管理员都应该能完成一项任务是恢复丢失的root密码，如果管理员仍处于登录状态，不管是作为拥有完成sudo 访问权限的非特权用户，还是作为root 用户，这个任务都很简单。如果未登录则复杂一点。  </p>
<p>有一些方法可用于设备新的root 密码。例如，系统管理员可以使用live cd 启动系统，从此处挂载root文件系统。然后编辑 /etc/shadow 。在本节中，我们将探讨一个无需使用外部介质的方法。</p>
<h6 id="注意：-1"><a href="#注意：-1" class="headerlink" title="注意："></a>注意：</h6><p>在RHEL 6及早期版本中，管理员可以启动系统进入runlevel 1 然后看到一个root 提示。在 RHEL7 中与 runlevel 1 最接近的是 rescue.target  和emergency.target 目标，这两个目标都需要 root 密码才能登录 。</p>
<p>在 RHEL 7中，可以使从 initramfs 运行的脚本在某些点暂停，提供 root shell ，然后在该 shell 存在的情况下继续 。虽然主要是为了进行调试，但也可用户恢复丢失的 root 密码。</p>
<p>1、重新启动</p>
<p>2、按任意键中断启动加载器倒计时。</p>
<p>3、将光标移动到需要启动的条目</p>
<p>4、按 e 编辑选定的条目</p>
<p>5、将光标移到内核命令行（以 linux16开头的行）</p>
<p>6、附加 rd.break （就在从initramfs 向实际系统移交控制权前，该操作会中断）。</p>
<h6 id="注意：-2"><a href="#注意：-2" class="headerlink" title="注意："></a>注意：</h6><pre><code>initramfs 提示会显示在内核命令行中指定为最后的任何控制台中。  
</code></pre><p>7、Ctrl +x 使用这些更改进行启动</p>
<h6 id="注意：-3"><a href="#注意：-3" class="headerlink" title="注意："></a>注意：</h6><pre><code>预建的映像可能会在内核中放置多个 console = 参数，以全支持各种各校的实施场景，对于 rd.break ，有一点需要注意的是，尽管许多内核消息将会发送到所有控制台，但提示符最终都将使用最后一个控制台。如果未看到提示符，可能要临时调整 console = 参数的顺序。  
</code></pre><p>此时，会显示 root shell ，且实际系统的 root 文件系统会在 /sysroot 中以只读方式挂载。</p>
<h6 id="重要："><a href="#重要：" class="headerlink" title="重要："></a>重要：</h6><pre><code>由于此时尚未启动 selinux ，因此任何创建的新文件都不会创建分配有selinux 上下文。请记住，有些工具（如passwd ）首先会创建一个新文件，然后移动新文件以代替要编辑的文件，从而有地创建不 selinux 上下文的新文件。  
</code></pre><h6 id="此时要恢复-root-密码，请使用以下步骤："><a href="#此时要恢复-root-密码，请使用以下步骤：" class="headerlink" title="此时要恢复 root 密码，请使用以下步骤："></a>此时要恢复 root 密码，请使用以下步骤：</h6><p>1、以读写方式重新挂载 /sysroot </p>
<p>mount -o remount,rw /sysroot</p>
<p>2、切换为 chroot 存入位置，其中 /sysroot 被视为文件系统树的 root </p>
<p>chroot /sysroot</p>
<p>3、设置新 root 密码</p>
<p>passwd root</p>
<p>4、确保所有未标记的文件（包括此时的 /etc/shadow）在启动过程中都会重新获得标记。</p>
<p>touch /.autorelabel</p>
<p>5、键入 exit 两次，第一次将退出 chroot 存放位置，第二次将退出 initramfs 调试 shell 。此时系统将继续进行启动，执行完整的 selinux 重新标记，然后再次重新启动。  </p>
<h4 id="使用-journalctl"><a href="#使用-journalctl" class="headerlink" title="使用 journalctl"></a>使用 journalctl</h4><p>查看以前（失败）启动日志会很有用。如果 journald 日志已被已久性的，则使用 journaclctl 工具即可查看。</p>
<p>首先确定启用了永久性的 journald 记录<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p -m2775 /var/<span class="built_in">log</span>/journal</span><br><span class="line">chwon :systemd-journal /var/<span class="built_in">log</span>/journal</span><br><span class="line">killall -USR1 systemd-journald</span><br></pre></td></tr></table></figure></p>
<p>要检查上一次启动的日志文件，请在journalctl 中使用 -b 选项。无需任何参数，-b 选项即可将输出过滤为仅包含与该启动有关的消息，但是如果参数为负数，则此选项将过滤出上次启动。例如：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">journalctl -b -l -p err</span><br></pre></td></tr></table></figure></p>
<p>该命令将显示上次启动中被评为错误或更严重级别的所有消息。</p>
<h5 id="诊断和修复-systemd-启动问题"><a href="#诊断和修复-systemd-启动问题" class="headerlink" title="诊断和修复 systemd 启动问题"></a>诊断和修复 systemd 启动问题</h5><p>如果在启动服务过程中出现问题，则有几个工具可供管理员用于协助调试和 / 或故障排除：</p>
<h6 id="早期调试-shell"><a href="#早期调试-shell" class="headerlink" title="早期调试 shell"></a>早期调试 shell</h6><p>通过运行 systemctl enable debug-shell.service 启动序列早期将在 tty9 (Ctrl + Alt +f9 )上生成一个root shell 。该 shell 会自动作为 root 登录 ，这样管理员可以在系统仍在启动时使用一些其他高度工具。</p>
<h6 id="tips-1"><a href="#tips-1" class="headerlink" title="tips :"></a>tips :</h6><p>在完成调试后，请不要忘记禁用 debug-shell.service 服务，因为该服务会使未经身份验证的 root shell 向任何有本地控制台访问权限的人员开放。</p>
<h6 id="紧急情况和救援目标"><a href="#紧急情况和救援目标" class="headerlink" title="紧急情况和救援目标"></a>紧急情况和救援目标</h6><p>通过从启动器加载将 systemd.unit=rescue.target 或 systemd.unit=emergency.target 附加到内核命令行，系统将生成特殊的救援或紧急情况 shell ，而不是正常启动。这两个 shell 都需要提供 root 密码。 emergency 目标使 root 文件系统以只读方式挂载，而rescue.target 等待sysinit.target 先完成，这样更多的系统会进行初始化 （例如日志记录、文件系统等）。</p>
<p>这些 shell 可以用于修复妨碍系统正常启动的任何问题；例如，服务之间的依赖关系循环、或 /etc/fstab  中的错误条目。从这些 shell 退出后，系统会继续进行正常启动过程</p>
<h6 id="阻塞作业"><a href="#阻塞作业" class="headerlink" title="阻塞作业"></a>阻塞作业</h6><p>在启动过程中，systemd 会生成大量作业。如果其中某些作业无法完成，则它们会妨碍其他作业运行。要检查当前作业列表，管理员可以使用命令 systemctl list-jobs 。所有列出为 running 的作业都必须先完成，然后列为 waiting 的作业可以继续。</p>
<h4 id="修复在启动时出现的文件系统问题"><a href="#修复在启动时出现的文件系统问题" class="headerlink" title="修复在启动时出现的文件系统问题"></a>修复在启动时出现的文件系统问题</h4><p>/etc/fstab 中的错误和损坏的文件系统可能会阻止系统启动。在大多数情况下，systemd 实际上会在超时后继续启动，或者降至需要提供 root 密码的紧急修复 shell </p>
<table>
<thead>
<tr>
<th style="text-align:left">问题</th>
<th>结果</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">损坏文件系统</td>
<td>systemd 将会尝试 fsck ,如果问题太严重而无法自动修复，则系统会提示用户从紧急 shell 手动运行 shell </td>
</tr>
<tr>
<td style="text-align:left">/etc/fstab 中引用的设备 /UUID 不存在</td>
<td>systemd 将等待一定的时间，等设备变得可用。如果设备未变得可用，则系统会在超时后用户降至紧急 shell 。</td>
</tr>
<tr>
<td style="text-align:left">/etc/fstab 中的挂载点不存在</td>
<td>systemd 会创建挂载点（如果可能） ; 否则，它会降至紧急 shell </td>
</tr>
</tbody>
</table>
<p>/etc/fstab 中指定的挂载点错误|系统将用户降至紧急 shell<br>|在所有情况下，管理员都可以使用 emergency.target 目标来诊断和修复问题，因为在显示紧急 shell 之前 ，不会挂载任何文件系统。</p>
<h6 id="注意：-4"><a href="#注意：-4" class="headerlink" title="注意："></a>注意：</h6><p>在文件系统问题中使用自动恢复 shell 时，请不要忘记在编辑 /etc/fstab 后发出 systemctl daemon-reload ，如果不重新加载，systemd 将继续使用旧版本。</p>
<h6 id="修复启动加载器问题"><a href="#修复启动加载器问题" class="headerlink" title="修复启动加载器问题"></a>修复启动加载器问题</h6><p>RHEL 7 中默认使用的启动加载是 grub2, GRand Unified Bootloader 的第二个主要版本</p>
<p>grub2 可以用来在 BIOS和 UEFI系统中进行启动，并且支持启动现代硬件上运行的几乎所有操作系统。</p>
<p>grub2 的主要配置文件是 /boot/grub2/grub.cfg ，但是管理员不应直接编辑文件，而是应用使用一组不同的配置文件和安装的内核列表，并借助名为 grub2-mkconfig 的工具生成配置。</p>
<p>grub2-mkconifg 会查看 /etc/default/grub 的选项（例如要使用的默认菜单超时及内核命令行），然后在 /etc/grub.d/ 中使用一组脚本来生成配置文件。</p>
<p>要永久更改启动加载器配置，管理员需要编辑前面列出的配置文件，然后运行以下命令：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grub2-mkconfig &gt; /boot/grub2/grub.cfg</span><br></pre></td></tr></table></figure></p>
<p>在进行较大更改的情况下，管理员可能更喜欢不经过重定向即运行该命令，这样可以首先检查结果。</p>
<h6 id="重要指令"><a href="#重要指令" class="headerlink" title="重要指令"></a>重要指令</h6><p>要为损坏的 grub2 配置排除故障，管理员需要先了解 /boot/grub2/grub.cfg 的语法。实际可启动条目是在 menuentry 块中编码的。在这些块中，linux16 和 initrd16 行指向（随内核命令行）从磁盘加载的内核以及要加载的 initramfs 。在启动时进行交互编辑的过程中，Tab 实例可用于查找这些文件。</p>
<p>这些块中的 set root 行不指向 rhel 7 系统的root 文件系统，而是指向 grub2 应从加载内核及 initramfs 文件的文件系统。语法为 harddrive,partition ，其中 hd0 是系统中的第一个硬盘驱动器，hd1 是第二个硬盘驱动器，依此类推。指定为 msdos1 的分区是该驱动器上的第一个 MBR 分区，指定为 gpt1 分区的第一个GPT分区  </p>
<h6 id="重新安装启动加载器"><a href="#重新安装启动加载器" class="headerlink" title="重新安装启动加载器"></a>重新安装启动加载器</h6><p>在启动加载器自身已损坏的情况下，可以使用 grub2-install 命令重新安装。在 BIOS系统中，应提供 MBR 中应安装 grub2 的磁盘作为参数。在 UEFI 系统中，当 EFI 系统分区挂载于 /boot/efi/上时，无需提供任何参数。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/10/16/rh134-e7-ac-ac-e5-8d-81-e4-b8-89-e7-ab-a0-e5-af-b9-red-hat-enterprise-linux-e5-90-af-e5-8a-a8-e8-bf-87-e7-a8-8b-e8-bf-9b-e7-a8-8b-e6-8e-a7-e5-88-b6-e6-95-85-e9-9a-9c-e6-8e-92-e9-99-a4/" data-id="cjqlgp08r001xqtkj9gq1zoi7" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/10/17/rh134-e7-ac-ac-e5-8d-81-e5-9b-9b-e7-ab-a0-e4-bd-bf-e7-94-a8-firewalld-e9-99-90-e5-88-b6-e7-bd-91-e7-bb-9c-e9-80-9a-e4-bf-a1/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          RH134 第十四章 使用 FIREWALLD 限制网络通信
        
      </div>
    </a>
  
  
    <a href="/2018/10/12/autofs-e8-87-aa-e5-8a-a8-e6-8c-82-e8-bd-bd/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">autofs 自动挂载</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/RHEL124/">RHEL124</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/RHEL134/">RHEL134</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/未分类/">未分类</a><span class="category-list-count">2</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/pxe/">pxe</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/samba/">samba</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/pxe/" style="font-size: 10px;">pxe</a> <a href="/tags/samba/" style="font-size: 10px;">samba</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">16</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/10/18/rh134-e7-ac-ac-e5-8d-81-e4-ba-94-e7-ab-a0-e7-b3-bb-e7-bb-9f-e7-ae-a1-e7-90-86-e4-ba-8c-e6-80-bb-e5-a4-8d-e4-b9-a0/">RH134 第十五章 系统管理二总复习</a>
          </li>
        
          <li>
            <a href="/2018/10/17/rh134-e7-ac-ac-e5-8d-81-e5-9b-9b-e7-ab-a0-e4-bd-bf-e7-94-a8-firewalld-e9-99-90-e5-88-b6-e7-bd-91-e7-bb-9c-e9-80-9a-e4-bf-a1/">RH134 第十四章 使用 FIREWALLD 限制网络通信</a>
          </li>
        
          <li>
            <a href="/2018/10/16/rh134-e7-ac-ac-e5-8d-81-e4-b8-89-e7-ab-a0-e5-af-b9-red-hat-enterprise-linux-e5-90-af-e5-8a-a8-e8-bf-87-e7-a8-8b-e8-bf-9b-e7-a8-8b-e6-8e-a7-e5-88-b6-e6-95-85-e9-9a-9c-e6-8e-92-e9-99-a4/">RH134 第十三章 对 RED HAT ENTERPRISE LINUX 启动过程进程控制故障排除</a>
          </li>
        
          <li>
            <a href="/2018/10/12/autofs-e8-87-aa-e5-8a-a8-e6-8c-82-e8-bd-bd/">autofs 自动挂载</a>
          </li>
        
          <li>
            <a href="/2018/10/11/rh134-e7-ac-ac-e5-8d-81-e4-ba-8c-e7-ab-a0-e8-ae-bf-e9-97-ae-e5-85-b7-e6-9c-89smb-e7-9a-84-e7-bd-91-e7-bb-9c-e5-ad-98-e5-82-a8/">RH134 第十二章 访问具有SMB的网络存储</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 change<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>